const TONE_MAP = {
  // æ—¥æœ¬èªã‚­ãƒ¼ï¼ˆå„ªå…ˆï¼‰
  'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«': {
    name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆã‚¿ãƒ¡å£ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã«è‡ªåˆ†ã®è¨€è‘‰ã§ã‚¿ãƒ¡å£ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬å½“ã«ãã®å ´ã«ã„ã‚‹äººé–“ãŒæ›¸ã„ãŸã‚ˆã†ãªæ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'å®Œå…¨ãªã‚¿ãƒ¡å£ã€‚ã€Œã€œã ã£ãŸã€ã€Œã€œã—ãŸã€ã€Œã€œã‹ã‚‚ã€ã€Œã€œã˜ã‚ƒã‚“ã€ã€Œã€œã ã­ã€ã€Œã€œã ãªã€ãŒèªå°¾',
      'ã€Œã§ã™ãƒ»ã¾ã™ãƒ»ã¾ã™ä½“ã€ã¯1æ–‡å­—ã‚‚ä½¿ã‚ãªã„ã€‚ã€Œã€œã‚“ã§ã™ã€ã€Œã€œã ã¨æ€ã„ã¾ã™ã€ã€Œã€œãªã‚Šã¾ã™ã€ã‚‚å…¨éƒ¨NG',
      '1æ–‡ã¯çŸ­ãï¼ˆ10ã€œ20æ–‡å­—ï¼‰ã€‚æ”¹è¡Œã‚’å¤šç”¨ã—ã¦ç¸¦ã«å±•é–‹ã™ã‚‹',
      'æ„Ÿæƒ…ãƒ»é©šããƒ»æœ¬éŸ³ã‚’æœ€åˆã«ç½®ãã€‚ã€Œã‚„ã°ã„ã€ã€Œã¾ã˜ã‹ã€ã€Œå¥½ãã™ãã‚‹ã€ã€Œã†ã‚Œã—ã„ã€ã‹ã‚‰å§‹ã‚ã¦OK',
      'çµµæ–‡å­—ã¯æ–‡æœ«ã«1ã€œ2å€‹ã ã‘ã€‚çµµæ–‡å­—ã§å§‹ã‚ãªã„',
      'ã€Œãªã‚“ã‹ã€œã€ã€Œã¡ã‚‡ã£ã¨ã€œã€ã€Œã‚ã£ã¡ã‚ƒã€œã€ãªã©ã®å£èªè¡¨ç¾ã‚’è‡ªç„¶ã«ä½¿ã†',
    ],
    forbidden_words: [
      'ã§ã™', 'ã¾ã™', 'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã',
      'ãŠå®¢æ§˜', 'çš†æ§˜', 'ã”ç´¹ä»‹', 'ã”æ¥åº—',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'ã„ãŸã—ã¾ã™', 'ã§ã—ã‚‡ã†', 'ãªã®ã§ã™', 'ãªã‚Šã¾ã™', 'ã ã¨æ€ã„ã¾ã™', 'ã‚“ã§ã™',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç´ æ•µãª', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'ã“ã‚Œä»Šæ—¥å±Šã„ãŸã‚„ã¤\nãšã£ã¨å¾…ã£ã¦ãŸã‹ã‚‰ã†ã‚Œã—\nãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šã™ãã¦ã‚‹ğŸ™Œ',
      'ã“ã‚ŒãŒã¾ã˜ã§ã‚ˆã‹ã£ãŸ\næ€ã£ã¦ãŸã‚ˆã‚Šå…¨ç„¶ã„ã„\nã¾ãŸçµ¶å¯¾é ¼ã‚€',
      'ãªã‚“ã‹ã“ã‚Œã™ã”ã„å¥½ã\nè¨€è‘‰ã«ã§ããªã„ã‘ã©\nãšã£ã¨è¦‹ã¦ã‚‰ã‚Œã‚‹ã‚„ã¤',
      'ã‚„ã°ã™ãã¦ç¬‘ãˆãªã„\nä¹…ã—ã¶ã‚Šã«ã“ã‚Œã ã‘æ„Ÿå‹•ã—ãŸ\nã¿ã‚“ãªã«ã‚‚è¦‹ã›ãŸã„',
    ],
    bad_examples: [
      'ä»Šæ—¥ã¯æ–°å•†å“ãŒå±Šãã¾ã—ãŸğŸ˜Šæœ¬å½“ã«ç´ æ•µãªã‚¢ã‚¤ãƒ†ãƒ ã§ã™ã€‚ãœã²ã”è¦§ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã«åŒ…ã¾ã‚ŒãŸç´ æ™´ã‚‰ã—ã„ä½“é¨“ã§ã—ãŸ',
      'ã“ã¡ã‚‰ã®å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™',
      'çš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
      'å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã‚“ã§ã™ãŒã€æœ¬å½“ã«ã‚ˆã‹ã£ãŸã¨æ€ã„ã¾ã™',
    ],
  },

  'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼': {
    name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼ˆè¦ªã—ã¿ã‚„ã™ã„ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã§å‹é”ã«è©±ã—ã‹ã‘ã‚‹ã‚ˆã†ã«ã€è‡ªç„¶ã«è¦ªã—ã¿ã‚„ã™ãæŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬ç‰©ã®äººé–“ã‚‰ã—ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã§OKã ãŒã€ã€Œã ã‚ˆã€ã€Œã ã­ã€ã€Œã—ã¦ã¿ã¦ã­ã€ãªã©ã‚‚æ··ãœã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯çµ¶å¯¾ä½¿ã‚ãªã„ã€‚å …è‹¦ã—ã•ã‚¼ãƒ­ã§',
      'æ„Ÿæƒ…ã‚„ç™ºè¦‹ã‚’ç´ ç›´ã«æ›¸ãã€‚ã€Œå¬‰ã—ã„ã€ã€Œã³ã£ãã‚Šã—ãŸã€ã€Œæ°—ã«å…¥ã£ãŸã€ãªã©ã‚’è‡ªç„¶ã«',
      'æ”¹è¡Œã§èª­ã¿ã‚„ã™ãã€‚1ã€œ2æ–‡ã§æ”¹è¡Œã™ã‚‹',
      'çµµæ–‡å­—ã¯2ã€œ3å€‹ã€‚æ–‡ç« ã®ä¸­ã«è‡ªç„¶ã«æ··ãœã‚‹',
      'ã€Œã¿ã‚“ãªã€ã€Œä¸€ç·’ã«ã€ã€Œã¾ãŸæ¥ã¦ã­ã€ãªã©è¦ªè¿‘æ„Ÿã®ã‚ã‚‹è¡¨ç¾ã‚’ä½¿ã†',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã', 'ã„ãŸã—ã¾ã™',
      'çš†æ§˜', 'ã”æ¥åº—', 'å¿ƒã‚ˆã‚Š',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'æ–°ã—ã„ã®å…¥è·ã—ã¾ã—ãŸğŸ“¦\næ€ã£ã¦ãŸã‚ˆã‚Šãšã£ã¨ã„ã„æ„Ÿã˜ã§å¬‰ã—ã„âœ¨\nã¿ã‚“ãªã¯ã‚‚ã†è¦‹ã¦ãã‚ŒãŸï¼Ÿ',
      'ä¹…ã—ã¶ã‚Šã«ã“ã‚Œä½¿ã£ãŸã‚‰\nã‚„ã£ã±ã‚Šå¥½ãã ãªã£ã¦ãªã£ãŸ\nã¾ãŸä»•å…¥ã‚Œã¦ã‚ˆã‹ã£ãŸ',
      'ä»Šæ—¥ã®ã¯ã“ã‚Œã§ã™ğŸ‰\næ°—ã«å…¥ã£ã¦ãã‚ŒãŸã‚‰å¬‰ã—ã„ãª\nãœã²ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚çš†æ§˜ãœã²ã”æ¥åº—ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'å¿ƒã‚ˆã‚Šçš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
    ],
  },

  'ä¸å¯§': {
    name: 'ä¸å¯§ï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚ãŠå®¢æ§˜ã«ä¸å¯§ã«ã€ã§ã‚‚å …è‹¦ã—ããªãã€æ¸©ã‹ã¿ã‚’æŒã£ã¦ä¼ãˆã¦ãã ã•ã„ã€‚AIãŒæ›¸ã„ãŸæ„Ÿã˜ã‚’å‡ºã•ãšã€èª å®Ÿãªäººé–“ã®è¨€è‘‰ã§æ›¸ã„ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚ã§ã‚‚å†·ãŸããªãã€æ¸©ã‹ã•ã‚’è¾¼ã‚ã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯ä½¿ã‚ãªã„ã€‚ã€Œã§ã™ã€ã€Œã¾ã™ã€ã€Œã—ã¾ã™ã€ã§ååˆ†',
      'çŸ­ãå…·ä½“çš„ã«ã€‚1æ–‡ã§æƒ…å ±ã‚’è©°ã‚è¾¼ã¾ãšã€æ”¹è¡Œã§åˆ†ã‘ã‚‹',
      'çµµæ–‡å­—ã¯1ã€œ2å€‹ã€‚æ§ãˆã‚ã«ã€ã§ã‚‚ç„¡æ©Ÿè³ªã«ãªã‚‰ãªã„ã‚ˆã†ä½¿ã†',
      'æ•°å­—ãƒ»å…·ä½“çš„ãªæƒ…å ±ã‚’å…¥ã‚Œã‚‹ã¨èª­ã‚“ã§ã‚‚ã‚‰ã„ã‚„ã™ã„ï¼ˆæ™‚é–“ã€ä¾¡æ ¼ã€æ—¥ç¨‹ãªã©ï¼‰',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ãã¾ã™', 'ã„ãŸã—ã¾ã™', 'ã„ãŸã ã‘ã¾ã™',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´ã•ã‚ŒãŸ', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'å¿ƒã‚ˆã‚Š', 'å¿ƒã‚†ãã¾ã§', 'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªã²ã¨ã¨ã',
    ],
    good_examples: [
      'æ–°ã—ã„å•†å“ãŒå…¥ã‚Šã¾ã—ãŸ\nä»Šé€±ã‹ã‚‰è²©å£²ã—ã¾ã™\nãœã²ãŠè©¦ã—ãã ã•ã„âœ¨',
      'æœ¬æ—¥ã¯18æ™‚ã§é–‰åº—ã—ã¾ã™\nãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„',
      'ä»Šæœˆã®æ–°ä½œã§ã™\nã“ã ã‚ã‚Šã®ç´ æã‚’ä½¿ã£ã¦ã„ã¾ã™\nãœã²ä¸€åº¦æ‰‹ã«å–ã£ã¦ã¿ã¦ãã ã•ã„',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ç”³ã—ä¸Šã’ã¾ã™',
      'æ´—ç·´ã•ã‚ŒãŸç©ºé–“ã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'ç´ æ™´ã‚‰ã—ã„ä½“é¨“ã‚’ã”æä¾›ã„ãŸã—ã¾ã™',
    ],
  },

  // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚è‹±èªã‚­ãƒ¼ã‚‚æ®‹ã™
  casual: {
    name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆã‚¿ãƒ¡å£ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã«è‡ªåˆ†ã®è¨€è‘‰ã§ã‚¿ãƒ¡å£ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬å½“ã«ãã®å ´ã«ã„ã‚‹äººé–“ãŒæ›¸ã„ãŸã‚ˆã†ãªæ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'å®Œå…¨ãªã‚¿ãƒ¡å£ã€‚ã€Œã€œã ã£ãŸã€ã€Œã€œã—ãŸã€ã€Œã€œã‹ã‚‚ã€ã€Œã€œã˜ã‚ƒã‚“ã€ã€Œã€œã ã­ã€ã€Œã€œã ãªã€ãŒèªå°¾',
      'ã€Œã§ã™ãƒ»ã¾ã™ãƒ»ã¾ã™ä½“ã€ã¯1æ–‡å­—ã‚‚ä½¿ã‚ãªã„ã€‚ã€Œã€œã‚“ã§ã™ã€ã€Œã€œã ã¨æ€ã„ã¾ã™ã€ã€Œã€œãªã‚Šã¾ã™ã€ã‚‚å…¨éƒ¨NG',
      '1æ–‡ã¯çŸ­ãï¼ˆ10ã€œ20æ–‡å­—ï¼‰ã€‚æ”¹è¡Œã‚’å¤šç”¨ã—ã¦ç¸¦ã«å±•é–‹ã™ã‚‹',
      'æ„Ÿæƒ…ãƒ»é©šããƒ»æœ¬éŸ³ã‚’æœ€åˆã«ç½®ãã€‚ã€Œã‚„ã°ã„ã€ã€Œã¾ã˜ã‹ã€ã€Œå¥½ãã™ãã‚‹ã€ã€Œã†ã‚Œã—ã„ã€ã‹ã‚‰å§‹ã‚ã¦OK',
      'çµµæ–‡å­—ã¯æ–‡æœ«ã«1ã€œ2å€‹ã ã‘ã€‚çµµæ–‡å­—ã§å§‹ã‚ãªã„',
      'ã€Œãªã‚“ã‹ã€œã€ã€Œã¡ã‚‡ã£ã¨ã€œã€ã€Œã‚ã£ã¡ã‚ƒã€œã€ãªã©ã®å£èªè¡¨ç¾ã‚’è‡ªç„¶ã«ä½¿ã†',
    ],
    forbidden_words: [
      'ã§ã™', 'ã¾ã™', 'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã',
      'ãŠå®¢æ§˜', 'çš†æ§˜', 'ã”ç´¹ä»‹', 'ã”æ¥åº—',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'ã„ãŸã—ã¾ã™', 'ã§ã—ã‚‡ã†', 'ãªã®ã§ã™', 'ãªã‚Šã¾ã™', 'ã ã¨æ€ã„ã¾ã™', 'ã‚“ã§ã™',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç´ æ•µãª', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'ã“ã‚Œä»Šæ—¥å±Šã„ãŸã‚„ã¤\nãšã£ã¨å¾…ã£ã¦ãŸã‹ã‚‰ã†ã‚Œã—\nãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šã™ãã¦ã‚‹ğŸ™Œ',
      'ã“ã‚ŒãŒã¾ã˜ã§ã‚ˆã‹ã£ãŸ\næ€ã£ã¦ãŸã‚ˆã‚Šå…¨ç„¶ã„ã„\nã¾ãŸçµ¶å¯¾é ¼ã‚€',
      'ãªã‚“ã‹ã“ã‚Œã™ã”ã„å¥½ã\nè¨€è‘‰ã«ã§ããªã„ã‘ã©\nãšã£ã¨è¦‹ã¦ã‚‰ã‚Œã‚‹ã‚„ã¤',
      'ã‚„ã°ã™ãã¦ç¬‘ãˆãªã„\nä¹…ã—ã¶ã‚Šã«ã“ã‚Œã ã‘æ„Ÿå‹•ã—ãŸ\nã¿ã‚“ãªã«ã‚‚è¦‹ã›ãŸã„',
    ],
    bad_examples: [
      'ä»Šæ—¥ã¯æ–°å•†å“ãŒå±Šãã¾ã—ãŸğŸ˜Šæœ¬å½“ã«ç´ æ•µãªã‚¢ã‚¤ãƒ†ãƒ ã§ã™ã€‚ãœã²ã”è¦§ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã«åŒ…ã¾ã‚ŒãŸç´ æ™´ã‚‰ã—ã„ä½“é¨“ã§ã—ãŸ',
      'ã“ã¡ã‚‰ã®å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™',
      'çš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
      'å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã‚“ã§ã™ãŒã€æœ¬å½“ã«ã‚ˆã‹ã£ãŸã¨æ€ã„ã¾ã™',
    ],
  },

  friendly: {
    name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼ˆè¦ªã—ã¿ã‚„ã™ã„ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã§å‹é”ã«è©±ã—ã‹ã‘ã‚‹ã‚ˆã†ã«ã€è‡ªç„¶ã«è¦ªã—ã¿ã‚„ã™ãæŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬ç‰©ã®äººé–“ã‚‰ã—ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã§OKã ãŒã€ã€Œã ã‚ˆã€ã€Œã ã­ã€ã€Œã—ã¦ã¿ã¦ã­ã€ãªã©ã‚‚æ··ãœã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯çµ¶å¯¾ä½¿ã‚ãªã„ã€‚å …è‹¦ã—ã•ã‚¼ãƒ­ã§',
      'æ„Ÿæƒ…ã‚„ç™ºè¦‹ã‚’ç´ ç›´ã«æ›¸ãã€‚ã€Œå¬‰ã—ã„ã€ã€Œã³ã£ãã‚Šã—ãŸã€ã€Œæ°—ã«å…¥ã£ãŸã€ãªã©ã‚’è‡ªç„¶ã«',
      'æ”¹è¡Œã§èª­ã¿ã‚„ã™ãã€‚1ã€œ2æ–‡ã§æ”¹è¡Œã™ã‚‹',
      'çµµæ–‡å­—ã¯2ã€œ3å€‹ã€‚æ–‡ç« ã®ä¸­ã«è‡ªç„¶ã«æ··ãœã‚‹',
      'ã€Œã¿ã‚“ãªã€ã€Œä¸€ç·’ã«ã€ã€Œã¾ãŸæ¥ã¦ã­ã€ãªã©è¦ªè¿‘æ„Ÿã®ã‚ã‚‹è¡¨ç¾ã‚’ä½¿ã†',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã', 'ã„ãŸã—ã¾ã™',
      'çš†æ§˜', 'ã”æ¥åº—', 'å¿ƒã‚ˆã‚Š',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'æ–°ã—ã„ã®å…¥è·ã—ã¾ã—ãŸğŸ“¦\næ€ã£ã¦ãŸã‚ˆã‚Šãšã£ã¨ã„ã„æ„Ÿã˜ã§å¬‰ã—ã„âœ¨\nã¿ã‚“ãªã¯ã‚‚ã†è¦‹ã¦ãã‚ŒãŸï¼Ÿ',
      'ä¹…ã—ã¶ã‚Šã«ã“ã‚Œä½¿ã£ãŸã‚‰\nã‚„ã£ã±ã‚Šå¥½ãã ãªã£ã¦ãªã£ãŸ\nã¾ãŸä»•å…¥ã‚Œã¦ã‚ˆã‹ã£ãŸ',
      'ä»Šæ—¥ã®ã¯ã“ã‚Œã§ã™ğŸ‰\næ°—ã«å…¥ã£ã¦ãã‚ŒãŸã‚‰å¬‰ã—ã„ãª\nãœã²ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚çš†æ§˜ãœã²ã”æ¥åº—ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'å¿ƒã‚ˆã‚Šçš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
    ],
  },

  professional: {
    name: 'ä¸å¯§ï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚ãŠå®¢æ§˜ã«ä¸å¯§ã«ã€ã§ã‚‚å …è‹¦ã—ããªãã€æ¸©ã‹ã¿ã‚’æŒã£ã¦ä¼ãˆã¦ãã ã•ã„ã€‚AIãŒæ›¸ã„ãŸæ„Ÿã˜ã‚’å‡ºã•ãšã€èª å®Ÿãªäººé–“ã®è¨€è‘‰ã§æ›¸ã„ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚ã§ã‚‚å†·ãŸããªãã€æ¸©ã‹ã•ã‚’è¾¼ã‚ã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯ä½¿ã‚ãªã„ã€‚ã€Œã§ã™ã€ã€Œã¾ã™ã€ã€Œã—ã¾ã™ã€ã§ååˆ†',
      'çŸ­ãå…·ä½“çš„ã«ã€‚1æ–‡ã§æƒ…å ±ã‚’è©°ã‚è¾¼ã¾ãšã€æ”¹è¡Œã§åˆ†ã‘ã‚‹',
      'çµµæ–‡å­—ã¯1ã€œ2å€‹ã€‚æ§ãˆã‚ã«ã€ã§ã‚‚ç„¡æ©Ÿè³ªã«ãªã‚‰ãªã„ã‚ˆã†ä½¿ã†',
      'æ•°å­—ãƒ»å…·ä½“çš„ãªæƒ…å ±ã‚’å…¥ã‚Œã‚‹ã¨èª­ã‚“ã§ã‚‚ã‚‰ã„ã‚„ã™ã„ï¼ˆæ™‚é–“ã€ä¾¡æ ¼ã€æ—¥ç¨‹ãªã©ï¼‰',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ãã¾ã™', 'ã„ãŸã—ã¾ã™', 'ã„ãŸã ã‘ã¾ã™',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´ã•ã‚ŒãŸ', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'å¿ƒã‚ˆã‚Š', 'å¿ƒã‚†ãã¾ã§', 'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªã²ã¨ã¨ã',
    ],
    good_examples: [
      'æ–°ã—ã„å•†å“ãŒå…¥ã‚Šã¾ã—ãŸ\nä»Šé€±ã‹ã‚‰è²©å£²ã—ã¾ã™\nãœã²ãŠè©¦ã—ãã ã•ã„âœ¨',
      'æœ¬æ—¥ã¯18æ™‚ã§é–‰åº—ã—ã¾ã™\nãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„',
      'ä»Šæœˆã®æ–°ä½œã§ã™\nã“ã ã‚ã‚Šã®ç´ æã‚’ä½¿ã£ã¦ã„ã¾ã™\nãœã²ä¸€åº¦æ‰‹ã«å–ã£ã¦ã¿ã¦ãã ã•ã„',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ç”³ã—ä¸Šã’ã¾ã™',
      'æ´—ç·´ã•ã‚ŒãŸç©ºé–“ã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'ç´ æ™´ã‚‰ã—ã„ä½“é¨“ã‚’ã”æä¾›ã„ãŸã—ã¾ã™',
    ],
  },
};

export const POST_LENGTH_MAP = {
  // æ—¥æœ¬èªã‚­ãƒ¼ï¼ˆå„ªå…ˆï¼‰
  'è¶…çŸ­æ–‡': { range: '80æ–‡å­—ä»¥å†…ï¼ˆçµ¶å¯¾å³å®ˆï¼‰', description: 'è¶…çŸ­æ–‡ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰' },
  'çŸ­æ–‡': { range: '100-150æ–‡å­—', description: 'çŸ­æ–‡' },
  'ä¸­æ–‡': { range: '200-300æ–‡å­—', description: 'ä¸­æ–‡' },
  'é•·æ–‡': { range: '400-500æ–‡å­—', description: 'é•·æ–‡' },

  // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚è‹±èªã‚­ãƒ¼ã‚‚æ®‹ã™
  xshort: { range: '80æ–‡å­—ä»¥å†…ï¼ˆçµ¶å¯¾å³å®ˆï¼‰', description: 'è¶…çŸ­æ–‡ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰' },
  short: { range: '100-150æ–‡å­—', description: 'çŸ­æ–‡' },
  medium: { range: '200-300æ–‡å­—', description: 'ä¸­æ–‡' },
  long: { range: '400-500æ–‡å­—', description: 'é•·æ–‡' },
};

// L5: importæ–‡ã¯æœ¬æ¥å…ˆé ­ã«ç½®ãã¹ãã ãŒã€ESMãŒhoistã™ã‚‹ãŸã‚å®Ÿå®³ã¯ãªã„
// æ¬¡å›ãƒªãƒ•ã‚¡ã‚¯ã‚¿æ™‚ã«ãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ã«ç§»å‹•ã™ã‚‹ã“ã¨
import { getHashtagsForCategory } from '../config/categoryDictionary.js';

function getToneName(tone) {
  const toneData = TONE_MAP[tone] || TONE_MAP.casual;
  return toneData.name;
}

function getToneData(tone) {
  return TONE_MAP[tone] || TONE_MAP.casual;
}

function getPostLengthInfo(length = 'medium') {
  return POST_LENGTH_MAP[length] || POST_LENGTH_MAP.medium;
}

/**
 * åº—èˆ—ç™»éŒ²ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildStoreParsePrompt(userInput) {
  return `ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰åº—èˆ—æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ã€JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚

å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ: ${userInput}

å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚èª¬æ˜æ–‡ã‚„è¿½åŠ ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãšã€JSONã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:

{
  "category": "æ¥­ç¨®ï¼ˆä¾‹: ãƒã‚¤ãƒ«ã‚µãƒ­ãƒ³ã€ã‚«ãƒ•ã‚§ã€ãƒ™ãƒ¼ã‚«ãƒªãƒ¼ãªã©ï¼‰",
  "name": "åº—èˆ—å",
  "strength": "ã“ã ã‚ã‚Šã‚„å¼·ã¿",
  "tone": "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼"
}

tone ã¯å¿…ãšä»¥ä¸‹ã®ã„ãšã‚Œã‹1ã¤ã‚’é¸ã‚“ã§ãã ã•ã„:
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ (è¦ªã—ã¿ã‚„ã™ã„ãƒ»æ˜ã‚‹ã„)
- ä¸å¯§ (ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»ãƒ“ã‚¸ãƒã‚¹çš„)
- ã‚«ã‚¸ãƒ¥ã‚¢ãƒ« (ã‚¿ãƒ¡å£ãƒ»è¦ªã—ã¿ã‚„ã™ã„)

category ã¯å…¥åŠ›ã•ã‚ŒãŸæ¥­ç¨®ã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

é‡è¦: å¿…ãšJSONã®ã¿ã‚’è¿”ã—ã€ä»–ã®æ–‡ç« ã‚’å«ã‚ãªã„ã§ãã ã•ã„ã€‚`;
}

/**
 * ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¤‰æ›
 */
function buildCharacterSection(store) {
  const character = store.config?.character_settings;
  if (!character) return '';

  const parts = [];

  if (character.catchphrases && character.catchphrases.length > 0) {
    parts.push(`ã€å£ç™–ãƒ»ã‚ˆãä½¿ã†è¡¨ç¾ï¼ˆå¿…ãšä½¿ã†ï¼‰ã€‘\n${character.catchphrases.join('ã€')}`);
  }

  if (character.ng_words && character.ng_words.length > 0) {
    parts.push(`ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆNGï¼‰ã€‘\n${character.ng_words.join('ã€')}`);
  }

  if (character.personality) {
    parts.push(`ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»å€‹æ€§ã€‘\n${character.personality}`);
  }

  if (parts.length === 0) return '';

  return `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ­ ã‚ãªãŸã®å€‹æ€§ï¼ˆæœ€å„ªå…ˆã§åæ˜ ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${parts.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
}

/**
 * ç”»åƒã‹ã‚‰æŠ•ç¨¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildImagePostPrompt(store, lengthOverride = null, blendedInsights = null, personalization = '', imageDescription = null) {
  const postLength = lengthOverride || store.config?.post_length || 'xshort';
  const lengthInfo = getPostLengthInfo(postLength);
  const toneData = getToneData(store.tone);

  const templates = store.config?.templates || {};
  // templateInfoã¯AIã«æ¸¡ã•ãªã„ï¼ˆç”Ÿæˆå¾Œã«æœ«å°¾å›ºå®šè¿½è¨˜ã™ã‚‹ãŸã‚ï¼‰
  const templateInfo = '';

  // é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ§‹ç¯‰ï¼ˆåŒæ¥­ç¨®ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åæ˜ ï¼‰
  let collectiveIntelligenceSection = '';
  let industryPatternSection = ''; // æ¥­ç¨®å‚¾å‘ï¼ˆå‚è€ƒï¼‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç½²åæ€§ä¿è­·ã®ãŸã‚åˆ†é›¢ï¼‰
  let dbTags = [];

  if (blendedInsights) {
    const { category, group, own } = blendedInsights;
    const insights = [];

    // C20ä¿®æ­£: topHashtags ãŒ Array ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¹ãƒ©ã‚¤ã‚¹
    if (category && category.sampleSize > 0 && Array.isArray(category.topHashtags)) {
      dbTags.push(...category.topHashtags.slice(0, 3));
    }
    if (group && group.sampleSize > 0 && Array.isArray(group.topHashtags)) {
      dbTags.push(...group.topHashtags.slice(0, 2));
    }
    // DBãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯è¾æ›¸ã®é™çš„ã‚¿ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (dbTags.length === 0 && store.category) {
      const staticTags = getHashtagsForCategory(store.category);
      dbTags.push(...staticTags.slice(0, 5));
    }

    // M5: ä¿å­˜å¼·åº¦ãŒé«˜ã„æŠ•ç¨¿ã®æ–‡å­—æ•°ï¼ˆãƒ¡ã‚¤ãƒ³æŒ‡æ¨™ï¼‰â€” ?? ã§ 0 ã‚’æ­£ã—ãæ‰±ã†
    const topPostsLength = category?.topPostsAvgLength ?? group?.topPostsAvgLength;
    const topSaveIntensity = category?.topPostsAvgSaveIntensity ?? group?.topPostsAvgSaveIntensity;
    if (topPostsLength) {
      const intensityNote = topSaveIntensity != null
        ? `ï¼ˆä¿å­˜å¼·åº¦ ${topSaveIntensity.toFixed(2)} ã®æŠ•ç¨¿ç¾¤ï¼‰`
        : '';
      insights.push(`ã€æ–‡å­—æ•°ï¼ˆå¿…é ˆï¼‰ã€‘\nä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿${intensityNote}ã®å¹³å‡æ–‡å­—æ•°: ${topPostsLength}æ–‡å­—\nâ€» ã“ã®æ–‡å­—æ•°ã‚’ç›®å®‰ã«ä½œæˆã—ã¦ãã ã•ã„`);
    }

    const avgEmojiCount = category?.avgEmojiCount ?? group?.avgEmojiCount;
    if (avgEmojiCount !== undefined && avgEmojiCount !== null) {
      insights.push(`ã€çµµæ–‡å­—ï¼ˆå¿…é ˆï¼‰ã€‘\nåŒæ¥­ç¨®ã®å¹³å‡çµµæ–‡å­—æ•°: ${Math.round(avgEmojiCount)}å€‹\nâ€» ã“ã®æ•°ã‚’ç›®å®‰ã«ä½¿ç”¨ã—ã¦ãã ã•ã„`);
    }

    const bestHours = category?.bestPostingHours || group?.bestPostingHours;
    if (bestHours && bestHours.length > 0) {
      insights.push(`ã€å‚è€ƒã€‘æœ€é©æŠ•ç¨¿æ™‚é–“å¸¯: ${bestHours.join('æ™‚, ')}æ™‚`);
    }

    // å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³: å‡ºæ‰€ã§æ‰±ã„ã‚’åˆ†ã‘ã‚‹ï¼ˆç½²åæ€§ä¿è­·ï¼‰
    // - è‡ªåº—èˆ—ãƒ‡ãƒ¼ã‚¿ â†’ å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«ã€Œç©æ¥µå‚è€ƒã€ã¨ã—ã¦æ®‹ã™ï¼ˆã“ã®ãŠåº—ã®ãƒ•ã‚¡ãƒ³ã«åŠ¹ããƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    // - æ¥­ç¨®ãƒ‡ãƒ¼ã‚¿ã®ã¿ â†’ åˆ¥ã®ã€Œå‚¾å‘å‚è€ƒã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ï¼ˆæ¥­ç¨®å¹³å‡ã¯å‡è³ªåŒ–ãƒªã‚¹ã‚¯ã‚ã‚‹ãŸã‚å¼·åˆ¶ã—ãªã„ï¼‰
    const ownWinningPattern = own?.winningPattern;
    const industryWinningPattern = ownWinningPattern ? null : (category?.winningPattern || group?.winningPattern);

    if (ownWinningPattern) {
      const hookJp = buildHookTypeJapanese(ownWinningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(ownWinningPattern.dominantCTAPosition);
      const lineBreakNote = ownWinningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : ownWinningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(ownWinningPattern.dominantCharBucket);
      const confidenceLabel = buildConfidenceLabel(ownWinningPattern.confidenceLevel);
      insights.push(`ã€ğŸ¯ ã‚ãªãŸã®åº—ã§ä¿å­˜ã•ã‚Œã‚„ã™ã‹ã£ãŸå‹${confidenceLabel}ï¼ˆ${ownWinningPattern.sampleSize}ä»¶ãƒ»ã‚ãªãŸå›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã€‘\nãƒ»1è¡Œç›®: ${hookJp}ï¼ˆ${ownWinningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTAä½ç½®: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nâ†’ ã“ã®ãŠåº—ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã«åˆºã•ã‚Šã‚„ã™ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚ç©æ¥µçš„ã«å‚è€ƒã«ã—ã¦ã‚ˆã„`);
    }

    if (industryWinningPattern) {
      const hookJp = buildHookTypeJapanese(industryWinningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(industryWinningPattern.dominantCTAPosition);
      const lineBreakNote = industryWinningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : industryWinningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(industryWinningPattern.dominantCharBucket);
      const sourceName = category?.winningPattern
        ? `åŒæ¥­ç¨®ï¼ˆ${blendedInsights.categoryGroup || ''}ï¼‰`
        : 'ã‚°ãƒ«ãƒ¼ãƒ—';
      industryPatternSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“ˆ ${sourceName}ã®å‚¾å‘ï¼ˆå‚è€ƒãƒ»ã“ã®åº—ã®å€‹æ€§ã‚’å„ªå…ˆã—ã¦ã‚ˆã„ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nä»¥ä¸‹ã¯æ¥­ç¨®å…¨ä½“ã®å¹³å‡å‚¾å‘ã§ã™ã€‚ã“ã®å†™çœŸãƒ»ã“ã®åº—ã®æ–‡è„ˆã¨åˆã‚ãªã‘ã‚Œã°ç„¡è¦–ã—ã¦ã‚ˆã„ï¼š\nãƒ»æ›¸ãå‡ºã—: ${hookJp}ãŒå¤šã„ï¼ˆ${industryWinningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTA: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }

    if (insights.length > 0) {
      collectiveIntelligenceSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã€å¿…ãšåæ˜ ã™ã‚‹ã“ã¨ã€‘ï¼ˆåŒæ¥­ç¨®${category?.sampleSize || 0}ä»¶ãƒ»ä¿å­˜å¼·åº¦ãƒ™ãƒ¼ã‚¹ï¼‰\nâ€» ä»¥ä¸‹ã®æŒ‡ç¤ºã¯ã€Œå®ˆã‚‹ã“ã¨ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Šå„ªå…ˆã—ã¦å³å®ˆã™ã‚‹\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${insights.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æŒ‡ç¤ºï¼ˆå„ªå…ˆé †ä½: ãƒ†ãƒ³ãƒ—ãƒ¬å›ºå®šã‚¿ã‚° â†’ é–¢é€£ã‚¿ã‚° â†’ é›†åˆçŸ¥ã‚¿ã‚°ï¼‰
  const categoryHint = store.category ? `æ¥­ç¨®ã€Œ${store.category}ã€` : '';
  const templateHashtags = templates.hashtags || [];
  let hashtagInstruction = '';

  if (imageDescription) {
    const fixedTagNote = templateHashtags.length > 0
      ? `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã®å¾Œã«ä»¥ä¸‹ã‚’è¿½åŠ :`
      : '';
    const collectiveTagNote = dbTags && dbTags.length > 0
      ? `\nè¿½åŠ å¯èƒ½ãªæ¥­ç¨®ã‚¿ã‚°ï¼ˆä¸Šè¨˜ã®å¾Œã«1-3å€‹è¿½åŠ ã—ã¦ã‚ˆã„ï¼‰: ${dbTags.join(', ')}`
      : '';
    hashtagInstruction = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå³å®ˆï¼‰ã€‘${fixedTagNote}\né †ç•ª: ${templateHashtags.length > 0 ? 'â‘ å›ºå®šã‚¿ã‚°ï¼ˆä¸Šè¨˜ï¼‰â†’ ' : ''}â‘¡å†™çœŸã«å®Ÿéš›ã«å†™ã£ã¦ã„ã‚‹ã‚‚ã®ãƒ»${categoryHint}ã«ç›´çµã™ã‚‹ã‚¿ã‚°ï¼ˆ3-5å€‹ï¼‰â†’ â‘¢æ¥­ç¨®ã®å®šç•ªã‚¿ã‚°ï¼ˆ1-3å€‹ï¼‰\nçµ¶å¯¾NGï¼šå†™çœŸã«å†™ã£ã¦ã„ãªã„ã‚‚ã®ã®ã‚¿ã‚°ã€#instagood #japan #photooftheday ãªã©ã®æ±ç”¨ã‚¿ã‚°${collectiveTagNote}`;
  } else if (!collectiveIntelligenceSection) {
    const fixedTagNote = templateHashtags.length > 0
      ? `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã®å¾Œã«é–¢é€£ã‚¿ã‚°ã‚’è¿½åŠ :`
      : '';
    const staticTagNote = dbTags && dbTags.length > 0
      ? `\nä»¥ä¸‹ã®æ¥­ç¨®ã‚¿ã‚°ã‹ã‚‰3-5å€‹ã‚’å¿…ãšä½¿ç”¨: ${dbTags.join(', ')}`
      : '';
    hashtagInstruction = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘${fixedTagNote}\n${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã«æœ€ã‚‚åˆã†ã‚¿ã‚°ã‚’åˆè¨ˆ5-8å€‹ã€‚#instagood #japan ãªã©æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚${staticTagNote}`;
  } else if (templateHashtags.length > 0) {
    // é›†åˆçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã§ã‚‚å›ºå®šã‚¿ã‚°ã‚’å„ªå…ˆã—ã¦è¿½è¨˜
    hashtagInstruction = `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæœ€å„ªå…ˆãƒ»å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã‚’å…ˆé ­ã«ç½®ãã€é›†åˆçŸ¥ã‚¿ã‚°ã¨é–¢é€£ã‚¿ã‚°ã‚’å¾Œã‚ã«è¿½åŠ ã™ã‚‹ã“ã¨ã€‚`;
  }

  // ç”»åƒåˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³
  const imageDescriptionSection = imageDescription
    ? `\nã€ã“ã®å†™çœŸã®è¦³å¯Ÿçµæœã€‘\n${imageDescription}\n`
    : '';

  const characterSection = buildCharacterSection(store);

  return `
## 1. ã‚ãªãŸã®å½¹å‰²
ã‚ãªãŸã¯${store.name}ã®åº—ä¸»ã®è¨€è‘‰ã‚’è‡ªç„¶ã«æ•´ãˆã‚‹ç·¨é›†è€…ã§ã™ã€‚
ç›®çš„ã¯ã€å†™çœŸã‚’è¦‹ãŸäººãŒ
1. ãã®åº—ã‚’æ€ã„å‡ºã—ã¦ã—ã¾ã†ã“ã¨ï¼ˆæƒ³èµ·ãƒˆãƒªã‚¬ãƒ¼ï¼‰
2. ã•ã‚Šã’ãªãè¡Œã£ã¦ã¿ã‚ˆã†ã‹ãªã¨æ€ã†ã“ã¨ï¼ˆæ¥åº—ãƒˆãƒªã‚¬ãƒ¼ï¼‰

å¼·ã„ã‚»ãƒ¼ãƒ«ã‚¹ã¯ç¦æ­¢ã€‚ä¸è‡ªç„¶ãªæ¯”å–©ã¯ç¦æ­¢ã€‚
èªå½™ã¯ä¸€èˆ¬çš„ã§è‡ªç„¶ãªæ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

## 2. çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰
${toneData.forbidden_words.join(', ')}, å¹»æƒ³çš„, ç´ æ•µ, é­…åŠ›çš„, ç´ æ™´ã‚‰ã—ã„, å®Œç’§, æœ€é«˜, ç¾ã—ã„, ã§ã™ã­, ãªã®ã§ã™ã­, å…‰ã®æ„å¿—, è³ªæ„Ÿã®ç‰©èª, æ²ˆé»™ã®ãƒ‡ã‚¶ã‚¤ãƒ³, è‚–åƒ, ç‹¬ç™½, å¿ƒæ‹æ•°, ä½“æ¸©

## 3. åº—ä¸»ã®å£èª¿
${toneData.persona}

ã€å£èª¿ãƒ«ãƒ¼ãƒ«ã€‘
${toneData.style_rules.map((r, i) => `${i + 1}. ${r}`).join('\n')}

ã€è‰¯ã„ä¾‹ã€‘
${toneData.good_examples.join('\n\n')}

ã€NGãªä¾‹ã€‘
${toneData.bad_examples.join('\n\n')}
${templateInfo}${characterSection}${imageDescriptionSection}${collectiveIntelligenceSection}${industryPatternSection}${hashtagInstruction}${personalization}

## 4. å‡ºåŠ›æ§‹æˆï¼ˆå³å®ˆï¼‰
ä»¥ä¸‹ã®å†™çœŸæƒ…å ±ã¨è£œè¶³æƒ…å ±ã‚’ã‚‚ã¨ã«InstagramæŠ•ç¨¿æ–‡ã‚’3æ¡ˆä½œæˆã—ã¦ãã ã•ã„ã€‚
ä½™è¨ˆãªæŒ¨æ‹¶ã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚ä»¥ä¸‹ã®å½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

ã€å„æ¡ˆã®æ§‹æˆã€‘
1. æœ¬æ–‡ï¼ˆåº—ä¸»ã®å£èª¿ã§è‡ªç„¶ã«ã€‚${lengthInfo.range}ï¼‰
2. æƒ³èµ·ã®ä¸€è¨€ï¼ˆäº”æ„Ÿã‚’1ã¤å«ã‚ã‚‹ãƒ»15ã€œ25æ–‡å­—ãƒ»æ”¹è¡Œã—ã¦æ›¸ãï¼‰
3. æ¥åº—ã®ä¸€æ–‡ï¼ˆå…·ä½“ã ãŒæŠ¼ã—å£²ã‚Šã§ãªã„ãƒ»æ”¹è¡Œã—ã¦æ›¸ãï¼‰
4. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°

ã€é‡è¦ãƒ«ãƒ¼ãƒ«ã€‘
- âš ï¸ æœ¬æ–‡ã¯ã€Œ${lengthInfo.range}ã€ã‚’**æœ€å„ªå…ˆã®çµ¶å¯¾åˆ¶é™**ã¨ã™ã‚‹ã€‚å£èª¿ãƒ«ãƒ¼ãƒ«ãƒ»å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãƒ»ä»–ã®ã„ã‹ãªã‚‹æŒ‡ç¤ºã‚ˆã‚Šã‚‚æ–‡å­—æ•°åˆ¶é™ãŒä¸Šä½ã€‚æ”¹è¡Œã‚’å¤šç”¨ã™ã‚‹å£èª¿ã§ã‚‚ã€æœ¬æ–‡å…¨ä½“ãŒ${lengthInfo.range}ã«åã¾ã‚‹ã‚ˆã†è¡Œæ•°ã‚’èª¿æ•´ã™ã‚‹ã€‚
- è©©çš„ã™ããªã„ãƒ»éåº¦ãªæ„Ÿæƒ…è¡¨ç¾ã‚’ã—ãªã„ãƒ»æŠ½è±¡çš„ã™ããªã„
- åº—ä¸»ãŒå®Ÿéš›ã«è¨€ã„ãã†ãªèªã‚Šå£ã«ã™ã‚‹
- æƒ³èµ·ã®ä¸€è¨€ã¯äº”æ„Ÿï¼ˆé¦™ã‚Šãƒ»éŸ³ãƒ»æ¸©åº¦ãƒ»å…‰ãƒ»æ‰‹è§¦ã‚Šï¼‰ã®ã©ã‚Œã‹1ã¤ã‚’å¿…ãšå«ã‚ã‚‹
- æ¥åº—ã®ä¸€æ–‡ã¯ã€Œä»Šã€ã€Œæ•°é‡ã€ã€Œæ™‚é–“ã€ãªã©å…·ä½“çš„ãªæƒ…å ±ã‚’1ã¤å…¥ã‚Œã‚‹
- æ¥åº—ã®ä¸€æ–‡ã¯æŠ¼ã—å£²ã‚Šã«ãªã‚‰ãªã„ã“ã¨ï¼ˆã€Œãœã²ã€ã€ŒãŠã™ã™ã‚ã€ç¦æ­¢ï¼‰
${collectiveIntelligenceSection ? '- ã€æœ€å„ªå…ˆã€‘é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ï¼ˆğŸ“Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã®æ–‡å­—æ•°ãƒ»çµµæ–‡å­—æ•°ã®æŒ‡ç¤ºã‚’å¿…ãšå®ˆã‚‹ï¼ˆã€Œå‚è€ƒã€ã§ã¯ãªãã€Œå³å®ˆã€ï¼‰' : ''}

ã€å‡ºåŠ›å½¢å¼ã€‘

[ æ¡ˆAï¼šè¨˜æ†¶ã«æ®‹ã‚‹æ—¥å¸¸ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
${hashtagInstruction ? 'ä¸Šè¨˜ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã€‚' : ''}
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

[ æ¡ˆBï¼šã•ã‚Šã’ãªã„èª˜ã„ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
${hashtagInstruction ? 'ä¸Šè¨˜ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã€‚' : ''}
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

[ æ¡ˆCï¼šåº—ä¸»ã®ã²ã¨ã‚Šã”ã¨ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
${hashtagInstruction ? 'ä¸Šè¨˜ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã€‚' : ''}
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¸ æ¬¡ã®æ’®å½±ã«
å†™çœŸã®è‰¯ã„ç‚¹ã‚’1ã¤è¤’ã‚ã€æ¬¡ã«è©¦ã›ã‚‹å…·ä½“çš„ãªææ¡ˆã‚’1ã¤ã ã‘ã€‚åˆè¨ˆ2è¡Œä»¥å†…ã€‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æŠ•ç¨¿æ–‡ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã‚„è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}

/**
 * ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æŠ•ç¨¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæŠœæœ¬æ”¹é©ç‰ˆï¼‰
 */
export function buildTextPostPrompt(store, userText, lengthOverride = null, blendedInsights = null, personalization = '') {
  const postLength = lengthOverride || store.config?.post_length || 'xshort';
  const lengthInfo = getPostLengthInfo(postLength);
  const toneData = getToneData(store.tone);

  const templates = store.config?.templates || {};
  // templateInfoã¯AIã«æ¸¡ã•ãªã„ï¼ˆç”Ÿæˆå¾Œã«æœ«å°¾å›ºå®šè¿½è¨˜ã™ã‚‹ãŸã‚ï¼‰
  const templateInfo = '';

  // é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ§‹ç¯‰ï¼ˆåŒæ¥­ç¨®ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åæ˜ ï¼‰
  let collectiveIntelligenceSection = '';
  let industryPatternSection = ''; // æ¥­ç¨®å‚¾å‘ï¼ˆå‚è€ƒï¼‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç½²åæ€§ä¿è­·ã®ãŸã‚åˆ†é›¢ï¼‰

  if (blendedInsights) {
    const { category, group, own } = blendedInsights;
    const insights = [];

    // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå„ªå…ˆåº¦1ï¼‰
    // C20ä¿®æ­£: topHashtags ãŒ Array ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¹ãƒ©ã‚¤ã‚¹
    const dbTags = [];
    if (category && category.sampleSize > 0 && Array.isArray(category.topHashtags)) {
      dbTags.push(...category.topHashtags.slice(0, 3));
    }
    if (group && group.sampleSize > 0 && Array.isArray(group.topHashtags)) {
      dbTags.push(...group.topHashtags.slice(0, 2));
    }
    // DBãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯è¾æ›¸ã®é™çš„ã‚¿ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (dbTags.length === 0 && store.category) {
      const staticTags = getHashtagsForCategory(store.category);
      dbTags.push(...staticTags.slice(0, 5));
    }

    if (dbTags.length > 0) {
      insights.push(`ã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\nä»¥ä¸‹ã¯åŒæ¥­ç¨®ã§é«˜ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã§ã™ã€‚3-5å€‹ã‚’å¿…ãšä½¿ç”¨:\n${dbTags.join(', ')}`);
    }

    // M5: æ–‡å­—æ•°ï¼ˆä¿å­˜å¼·åº¦ãŒé«˜ã„æŠ•ç¨¿ãƒ™ãƒ¼ã‚¹ï¼‰â€” ?? ã§ 0 ã‚’æ­£ã—ãæ‰±ã†
    const topPostsLength = category?.topPostsAvgLength ?? group?.topPostsAvgLength;
    const topSaveIntensity = category?.topPostsAvgSaveIntensity ?? group?.topPostsAvgSaveIntensity;
    if (topPostsLength) {
      const intensityNote = topSaveIntensity != null
        ? `ï¼ˆä¿å­˜å¼·åº¦ ${topSaveIntensity.toFixed(2)} ã®æŠ•ç¨¿ç¾¤ï¼‰`
        : '';
      insights.push(`ã€æ–‡å­—æ•°ï¼ˆå¿…é ˆï¼‰ã€‘\nä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿${intensityNote}ã®å¹³å‡æ–‡å­—æ•°: ${topPostsLength}æ–‡å­—\nâ€» ã“ã®æ–‡å­—æ•°ã‚’ç›®å®‰ã«ä½œæˆã—ã¦ãã ã•ã„`);
    }

    // çµµæ–‡å­—ï¼ˆå„ªå…ˆåº¦3ï¼‰
    const avgEmojiCount = category?.avgEmojiCount ?? group?.avgEmojiCount;
    if (avgEmojiCount !== undefined && avgEmojiCount !== null) {
      insights.push(`ã€çµµæ–‡å­—ï¼ˆå¿…é ˆï¼‰ã€‘\nåŒæ¥­ç¨®ã®å¹³å‡çµµæ–‡å­—æ•°: ${Math.round(avgEmojiCount)}å€‹\nâ€» ã“ã®æ•°ã‚’ç›®å®‰ã«ä½¿ç”¨ã—ã¦ãã ã•ã„`);
    }

    // æŠ•ç¨¿æ™‚é–“å¸¯ï¼ˆå‚è€ƒæƒ…å ±ï¼‰
    const bestHours = category?.bestPostingHours || group?.bestPostingHours;
    if (bestHours && bestHours.length > 0) {
      insights.push(`ã€å‚è€ƒã€‘æœ€é©æŠ•ç¨¿æ™‚é–“å¸¯: ${bestHours.join('æ™‚, ')}æ™‚`);
    }

    // å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³: å‡ºæ‰€ã§æ‰±ã„ã‚’åˆ†ã‘ã‚‹ï¼ˆç½²åæ€§ä¿è­·ï¼‰
    const ownWinningPattern = own?.winningPattern;
    const industryWinningPattern = ownWinningPattern ? null : (category?.winningPattern || group?.winningPattern);

    if (ownWinningPattern) {
      const hookJp = buildHookTypeJapanese(ownWinningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(ownWinningPattern.dominantCTAPosition);
      const lineBreakNote = ownWinningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : ownWinningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(ownWinningPattern.dominantCharBucket);
      const confidenceLabel = buildConfidenceLabel(ownWinningPattern.confidenceLevel);
      insights.push(`ã€ğŸ¯ ã‚ãªãŸã®åº—ã§ä¿å­˜ã•ã‚Œã‚„ã™ã‹ã£ãŸå‹${confidenceLabel}ï¼ˆ${ownWinningPattern.sampleSize}ä»¶ãƒ»ã‚ãªãŸå›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã€‘\nãƒ»1è¡Œç›®: ${hookJp}ï¼ˆ${ownWinningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTAä½ç½®: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nâ†’ ã“ã®ãŠåº—ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã«åˆºã•ã‚Šã‚„ã™ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚ç©æ¥µçš„ã«å‚è€ƒã«ã—ã¦ã‚ˆã„`);
    }

    if (industryWinningPattern) {
      const hookJp = buildHookTypeJapanese(industryWinningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(industryWinningPattern.dominantCTAPosition);
      const lineBreakNote = industryWinningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : industryWinningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(industryWinningPattern.dominantCharBucket);
      const sourceName = category?.winningPattern
        ? `åŒæ¥­ç¨®ï¼ˆ${blendedInsights.categoryGroup || ''}ï¼‰`
        : 'ã‚°ãƒ«ãƒ¼ãƒ—';
      industryPatternSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“ˆ ${sourceName}ã®å‚¾å‘ï¼ˆå‚è€ƒãƒ»ã“ã®åº—ã®å€‹æ€§ã‚’å„ªå…ˆã—ã¦ã‚ˆã„ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nä»¥ä¸‹ã¯æ¥­ç¨®å…¨ä½“ã®å¹³å‡å‚¾å‘ã§ã™ã€‚ã“ã®åº—ã®æ–‡è„ˆã¨åˆã‚ãªã‘ã‚Œã°ç„¡è¦–ã—ã¦ã‚ˆã„ï¼š\nãƒ»æ›¸ãå‡ºã—: ${hookJp}ãŒå¤šã„ï¼ˆ${industryWinningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTA: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }

    if (insights.length > 0) {
      collectiveIntelligenceSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã€å¿…ãšåæ˜ ã™ã‚‹ã“ã¨ã€‘ï¼ˆåŒæ¥­ç¨®${category?.sampleSize || 0}ä»¶ãƒ»ä¿å­˜å¼·åº¦ãƒ™ãƒ¼ã‚¹ï¼‰\nâ€» ä»¥ä¸‹ã®æŒ‡ç¤ºã¯ã€Œãƒ«ãƒ¼ãƒ«ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Šå„ªå…ˆã—ã¦å³å®ˆã™ã‚‹\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${insights.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå„ªå…ˆé †ä½: ãƒ†ãƒ³ãƒ—ãƒ¬å›ºå®šã‚¿ã‚° â†’ é–¢é€£ã‚¿ã‚° â†’ é›†åˆçŸ¥ã‚¿ã‚°ï¼‰
  const templateHashtags = templates.hashtags || [];
  let fallbackHashtags = '';

  if (!collectiveIntelligenceSection) {
    const categoryHint = store.category ? `æ¥­ç¨®ã¯ã€Œ${store.category}ã€ã€‚` : '';
    if (templateHashtags.length > 0) {
      fallbackHashtags = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\nä»¥ä¸‹ã®å›ºå®šã‚¿ã‚°ã‚’å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹:\n${templateHashtags.join(' ')}\nãã®å¾Œã«${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã«åˆã†ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¦åˆè¨ˆ5-8å€‹ã«ã™ã‚‹ã€‚#instagood #japan ãªã©ã®æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚`;
    } else {
      fallbackHashtags = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\n${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã‚’ç›´æ¥èª­ã‚“ã§ã€å†…å®¹ã«æœ€ã‚‚åˆã†Instagramãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’5-8å€‹ä»˜ã‘ã‚‹ã€‚æ¥­ç¨®ã‚¿ã‚°ã¨æŠ•ç¨¿å†…å®¹ã‚¿ã‚°ã‚’ä¸¡æ–¹å«ã‚ã‚‹ã“ã¨ã€‚#instagood #japan #photooftheday ãªã©ã®æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚`;
    }
  } else if (templateHashtags.length > 0) {
    // é›†åˆçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã§ã‚‚å›ºå®šã‚¿ã‚°ã‚’å„ªå…ˆ
    fallbackHashtags = `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæœ€å„ªå…ˆãƒ»å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã‚’å…ˆé ­ã«ç½®ãã€é›†åˆçŸ¥ã‚¿ã‚°ã‚’å¾Œã‚ã«è¿½åŠ ã™ã‚‹ã“ã¨ã€‚`;
  }

  const characterSection = buildCharacterSection(store);

  return `ã‚ãªãŸã¯${store.name}ã®åº—ä¸»ã®è¨€è‘‰ã‚’è‡ªç„¶ã«æ•´ãˆã‚‹ç·¨é›†è€…ã§ã™ã€‚
ç›®çš„ã¯ã€æŠ•ç¨¿ã‚’è¦‹ãŸäººãŒ
1. ãã®åº—ã‚’æ€ã„å‡ºã—ã¦ã—ã¾ã†ã“ã¨ï¼ˆæƒ³èµ·ãƒˆãƒªã‚¬ãƒ¼ï¼‰
2. ã•ã‚Šã’ãªãè¡Œã£ã¦ã¿ã‚ˆã†ã‹ãªã¨æ€ã†ã“ã¨ï¼ˆæ¥åº—ãƒˆãƒªã‚¬ãƒ¼ï¼‰

å¼·ã„ã‚»ãƒ¼ãƒ«ã‚¹ã¯ç¦æ­¢ã€‚ä¸è‡ªç„¶ãªæ¯”å–©ã¯ç¦æ­¢ã€‚

ã€åº—ä¸»ã®å£èª¿ã€‘
${toneData.persona}

ã€å£èª¿ãƒ«ãƒ¼ãƒ«ï¼ˆå³å®ˆï¼‰ã€‘
${toneData.style_rules.map((r, i) => `${i + 1}. ${r}`).join('\n')}

ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰ã€‘
${toneData.forbidden_words.join(', ')}, å¹»æƒ³çš„, ç´ æ•µ, é­…åŠ›çš„, ç´ æ™´ã‚‰ã—ã„, å®Œç’§, æœ€é«˜, ç¾ã—ã„, ã§ã™ã­, ãªã®ã§ã™ã­, å…‰ã®æ„å¿—, è³ªæ„Ÿã®ç‰©èª, æ²ˆé»™ã®ãƒ‡ã‚¶ã‚¤ãƒ³, è‚–åƒ, ç‹¬ç™½, å¿ƒæ‹æ•°, ä½“æ¸©

ã€è‰¯ã„ä¾‹ã€‘
${toneData.good_examples.join('\n\n')}

ã€NGãªä¾‹ã€‘
${toneData.bad_examples.join('\n\n')}
${templateInfo}${characterSection}${collectiveIntelligenceSection}${industryPatternSection}${fallbackHashtags}${personalization}

ã€ä»Šå›ä¼ãˆãŸã„å†…å®¹ã€‘
${userText}

ã€å‡ºåŠ›æ§‹æˆï¼ˆå³å®ˆï¼‰ã€‘
ä¸Šè¨˜ã®å†…å®¹ã‚’ã‚‚ã¨ã«InstagramæŠ•ç¨¿æ–‡ã‚’3æ¡ˆä½œæˆã—ã¦ãã ã•ã„ã€‚
ä½™è¨ˆãªæŒ¨æ‹¶ã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚ä»¥ä¸‹ã®å½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

ã€å„æ¡ˆã®æ§‹æˆã€‘
1. æœ¬æ–‡ï¼ˆåº—ä¸»ã®å£èª¿ã§è‡ªç„¶ã«ã€‚${lengthInfo.range}ï¼‰
2. æƒ³èµ·ã®ä¸€è¨€ï¼ˆäº”æ„Ÿã‚’1ã¤å«ã‚ã‚‹ãƒ»15ã€œ25æ–‡å­—ãƒ»æ”¹è¡Œã—ã¦æ›¸ãï¼‰
3. æ¥åº—ã®ä¸€æ–‡ï¼ˆå…·ä½“ã ãŒæŠ¼ã—å£²ã‚Šã§ãªã„ãƒ»æ”¹è¡Œã—ã¦æ›¸ãï¼‰
4. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°

ã€é‡è¦ãƒ«ãƒ¼ãƒ«ã€‘
- âš ï¸ æœ¬æ–‡ã¯ã€Œ${lengthInfo.range}ã€ã‚’**æœ€å„ªå…ˆã®çµ¶å¯¾åˆ¶é™**ã¨ã™ã‚‹ã€‚å£èª¿ãƒ«ãƒ¼ãƒ«ãƒ»å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãƒ»ä»–ã®ã„ã‹ãªã‚‹æŒ‡ç¤ºã‚ˆã‚Šã‚‚æ–‡å­—æ•°åˆ¶é™ãŒä¸Šä½ã€‚æ”¹è¡Œã‚’å¤šç”¨ã™ã‚‹å£èª¿ã§ã‚‚ã€æœ¬æ–‡å…¨ä½“ãŒ${lengthInfo.range}ã«åã¾ã‚‹ã‚ˆã†è¡Œæ•°ã‚’èª¿æ•´ã™ã‚‹ã€‚
- è©©çš„ã™ããªã„ãƒ»éåº¦ãªæ„Ÿæƒ…è¡¨ç¾ã‚’ã—ãªã„ãƒ»æŠ½è±¡çš„ã™ããªã„
- åº—ä¸»ãŒå®Ÿéš›ã«è¨€ã„ãã†ãªèªã‚Šå£ã«ã™ã‚‹
- æƒ³èµ·ã®ä¸€è¨€ã¯äº”æ„Ÿï¼ˆé¦™ã‚Šãƒ»éŸ³ãƒ»æ¸©åº¦ãƒ»å…‰ãƒ»æ‰‹è§¦ã‚Šï¼‰ã®ã©ã‚Œã‹1ã¤ã‚’å¿…ãšå«ã‚ã‚‹
- æ¥åº—ã®ä¸€æ–‡ã¯ã€Œä»Šã€ã€Œæ•°é‡ã€ã€Œæ™‚é–“ã€ãªã©å…·ä½“çš„ãªæƒ…å ±ã‚’1ã¤å…¥ã‚Œã‚‹
- æ¥åº—ã®ä¸€æ–‡ã¯æŠ¼ã—å£²ã‚Šã«ãªã‚‰ãªã„ã“ã¨ï¼ˆã€Œãœã²ã€ã€ŒãŠã™ã™ã‚ã€ç¦æ­¢ï¼‰
${collectiveIntelligenceSection ? '- ã€æœ€å„ªå…ˆã€‘é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ï¼ˆğŸ“Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã®æ–‡å­—æ•°ãƒ»çµµæ–‡å­—æ•°ãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®æŒ‡ç¤ºã‚’å¿…ãšå®ˆã‚‹ï¼ˆã€Œå‚è€ƒã€ã§ã¯ãªãã€Œå³å®ˆã€ï¼‰' : ''}

ã€å‡ºåŠ›å½¢å¼ã€‘

[ æ¡ˆAï¼šè¨˜æ†¶ã«æ®‹ã‚‹æ—¥å¸¸ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

[ æ¡ˆBï¼šã•ã‚Šã’ãªã„èª˜ã„ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

[ æ¡ˆCï¼šåº—ä¸»ã®ã²ã¨ã‚Šã”ã¨ ]
ï¼ˆæœ¬æ–‡ï¼‰

ï¼ˆæƒ³èµ·ã®ä¸€è¨€ï¼‰
ï¼ˆæ¥åº—ã®ä¸€æ–‡ï¼‰
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

æŠ•ç¨¿æ–‡ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã‚„è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}

/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæƒ…å ±ã‚’ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®ç›´å‰ã«æŒ¿å…¥ã™ã‚‹ï¼ˆAIã«æ¸¡ã•ãšç›´æ¥ä»˜ã‘ã‚‹ï¼‰
 * æ§‹é€ : æœ¬æ–‡ â†’ ä½æ‰€ãƒ»å–¶æ¥­æ™‚é–“ãªã© â†’ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° â†’ â”â”â” Photo Advice â”â”â”
 */
export function appendTemplateFooter(postContent, store) {
  const templates = store.config?.templates || {};
  const infoLines = [];

  if (templates.ä½æ‰€) infoLines.push(`ğŸ“ ${templates.ä½æ‰€}`);
  if (templates.å–¶æ¥­æ™‚é–“) infoLines.push(`ğŸ• ${templates.å–¶æ¥­æ™‚é–“}`);
  Object.entries(templates.custom_fields || {}).forEach(([k, v]) => {
    infoLines.push(`${k}: ${v}`);
  });

  if (infoLines.length === 0) return postContent;

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œï¼ˆ#ã§å§‹ã¾ã‚‹è¡Œï¼‰ã¨Photo AdviceåŒºåˆ‡ã‚Šç·šã‚’æ¢ã™
  // åŒºåˆ‡ã‚Šç·šï¼ˆâ”ï¼‰ã§PostAdviceã‚’åˆ†é›¢
  const dividerPattern = /\n(â”{5,}[\s\S]*)/;
  const dividerMatch = postContent.match(dividerPattern);

  if (dividerMatch) {
    // åŒºåˆ‡ã‚Šç·šãŒã‚ã‚‹å ´åˆï¼šåŒºåˆ‡ã‚Šç·šã®å‰ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œã‚’è¦‹ã¤ã‘ã¦ãã®å‰ã«æŒ¿å…¥
    const beforeDivider = postContent.slice(0, dividerMatch.index);
    const dividerAndAfter = dividerMatch[1];

    // beforeDividerå†…ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œï¼ˆ#ã§å§‹ã¾ã‚‹è¡Œï¼‰ã‚’åˆ†é›¢
    const hashtagLinePattern = /\n(#[^\n]+)(\s*)$/;
    const hashtagMatch = beforeDivider.match(hashtagLinePattern);

    if (hashtagMatch) {
      const bodyPart = beforeDivider.slice(0, hashtagMatch.index);
      const hashtagPart = hashtagMatch[1];
      // L5ä¿®æ­£: ä½™åˆ†ãªâ”ã‚’è¿½åŠ ã—ãªã„ï¼ˆdividerAndAfterã«ã¯æ—¢ã«â”ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼‰
      return `${bodyPart}\n\n${infoLines.join('\n')}\n${hashtagPart}\n\n${dividerAndAfter}`;
    }
    // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡ŒãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯åŒºåˆ‡ã‚Šç·šã®å‰ã«æŒ¿å…¥
    return `${beforeDivider}\n\n${infoLines.join('\n')}\n\n${dividerAndAfter}`;
  }

  // åŒºåˆ‡ã‚Šç·šãŒãªã„å ´åˆï¼šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œã®å‰ã«æŒ¿å…¥
  const hashtagLinePattern = /\n(#[^\n]+)\s*$/;
  const hashtagMatch = postContent.match(hashtagLinePattern);

  if (hashtagMatch) {
    const bodyPart = postContent.slice(0, hashtagMatch.index);
    const hashtagPart = hashtagMatch[1];
    return `${bodyPart}\n\n${infoLines.join('\n')}\n${hashtagPart}`;
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚‚åŒºåˆ‡ã‚Šç·šã‚‚ãªã„å ´åˆã¯æœ«å°¾ã«è¿½è¨˜
  return `${postContent}\n\n${infoLines.join('\n')}`;
}

/**
 * hook_typeã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildHookTypeJapanese(hookType) {
  const map = {
    emotion: 'æ„Ÿæƒ…ãƒ»æœ¬éŸ³å…ˆè¡Œï¼ˆã€Œã‚„ã°ã„ã€ã€Œå¥½ãã™ãã€ãªã©ï¼‰',
    question: 'å•ã„ã‹ã‘ï¼ˆã€Œã€œçŸ¥ã£ã¦ã‚‹ï¼Ÿã€ãªã©ï¼‰',
    taigen_dome: 'ä½“è¨€æ­¢ã‚ï¼ˆçŸ­ã„åè©ã§ä½™ç™½ã‚’ä½œã‚‹ï¼‰',
    fact: 'äº‹å®Ÿãƒ»ãŠçŸ¥ã‚‰ã›å…ˆè¡Œ',
    unknown: 'æ§˜ã€…',
  };
  return map[hookType] || hookType;
}

/**
 * CTAä½ç½®ã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildCTAPositionJapanese(pos) {
  const map = {
    none: 'CTAãªã—',
    early: 'å†’é ­ï¼ˆè¡Œå‹•å–šèµ·ã‚’æœ€åˆã«ï¼‰',
    middle: 'ä¸­ç›¤',
    end: 'æœ«å°¾ï¼ˆæœ€å¾Œã«è¡Œå‹•å–šèµ·ï¼‰',
  };
  return map[pos] || pos;
}

/**
 * æ–‡å­—æ•°å¸¯ã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildCharBucketJapanese(bucket) {
  const map = {
    short: '100æ–‡å­—æœªæº€ï¼ˆçŸ­æ–‡ï¼‰',
    medium: '100ã€œ200æ–‡å­—ï¼ˆä¸­æ–‡ï¼‰',
    long: '200æ–‡å­—ä»¥ä¸Šï¼ˆé•·æ–‡ï¼‰',
  };
  return map[bucket] || 'ä¸æ˜';
}

/**
 * ä¿¡é ¼ãƒ¬ãƒ™ãƒ«ã‚’ãƒ©ãƒ™ãƒ«è¡¨è¨˜ã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 * - low    : 10ã€œ19ä»¶ï¼ˆä»®èª¬æ®µéšï¼‰
 * - medium : 20ã€œ29ä»¶ï¼ˆå‚è€ƒå€¤ï¼‰
 * - high   : 30ä»¶ä»¥ä¸Šï¼ˆé«˜ä¿¡é ¼ï¼‰
 */
function buildConfidenceLabel(level) {
  const map = {
    low: 'ã€ä»®èª¬æ®µéšã€‘',
    medium: 'ã€å‚è€ƒå€¤ã€‘',
    high: 'ã€é«˜ä¿¡é ¼ã€‘',
  };
  return map[level] ? `${map[level]}` : '';
}

/**
 * ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ãä¿®æ­£ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildRevisionPrompt(store, originalPost, feedback, advancedPersonalization = '') {
  const toneData = getToneData(store.tone);
  const characterSection = buildCharacterSection(store);

  return `ã‚ãªãŸã¯${store.name}ã®åº—ä¸»ã®è¨€è‘‰ã‚’è‡ªç„¶ã«æ•´ãˆã‚‹ç·¨é›†è€…ã§ã™ã€‚ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

ã€ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ«ãƒ¼ãƒ«ï¼ˆDual Trigger Modelï¼‰ã€‘
- æƒ³èµ·ãƒˆãƒªã‚¬ãƒ¼: äº”æ„Ÿãƒ»æ™‚é–“å¸¯ãƒ»å°ã•ãªæƒ…æ™¯ã§åº—ã‚’æ€ã„å‡ºã•ã›ã‚‹
- æ¥åº—ãƒˆãƒªã‚¬ãƒ¼: ã€Œä»Šã€ã€Œæ•°é‡ã€ã€Œæ™‚é–“ã€ãªã©å…·ä½“ã‚’1ã¤å…¥ã‚Œã€ã•ã‚Šã’ãªãå‹•ã‹ã™
- è©©çš„ã™ããªã„ãƒ»éåº¦ãªæ„Ÿæƒ…è¡¨ç¾ã‚’ã—ãªã„ãƒ»æŠ½è±¡çš„ã™ããªã„
- åº—ä¸»ãŒå®Ÿéš›ã«è¨€ã„ãã†ãªèªã‚Šå£ã«ã™ã‚‹

ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰ï¼ˆAIä¸¸å‡ºã—ã«ãªã‚‹ã®ã§NGï¼‰ã€‘
${toneData.forbidden_words.join(', ')}, å¹»æƒ³çš„, ç´ æ•µ, é­…åŠ›çš„, ç´ æ™´ã‚‰ã—ã„, å®Œç’§, æœ€é«˜, ç¾ã—ã„, ã§ã™ã­, ãªã®ã§ã™ã­, å…‰ã®æ„å¿—, è³ªæ„Ÿã®ç‰©èª, æ²ˆé»™ã®ãƒ‡ã‚¶ã‚¤ãƒ³, è‚–åƒ, ç‹¬ç™½, å¿ƒæ‹æ•°, ä½“æ¸©
${advancedPersonalization}${characterSection}
ã€å…ƒã®æŠ•ç¨¿ã€‘
${originalPost}

ã€ä¿®æ­£æŒ‡ç¤ºï¼ˆã“ã‚Œã ã‘ã‚’å®ˆã‚Œã°ååˆ†ï¼‰ã€‘
${feedback}

ä¿®æ­£æŒ‡ç¤ºã‚’100%åæ˜ ã—ã¦ãã ã•ã„ã€‚ä¿®æ­£æŒ‡ç¤ºã«æ›¸ã‹ã‚Œã¦ã„ãªã„ã“ã¨ã¯å…ƒã®æŠ•ç¨¿ã‚’ãã®ã¾ã¾ç¶­æŒã—ã¦ãã ã•ã„ã€‚
ä¿®æ­£ã—ãŸæŠ•ç¨¿ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ãƒ»è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}
