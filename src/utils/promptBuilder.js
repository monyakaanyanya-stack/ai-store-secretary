const TONE_MAP = {
  // æ—¥æœ¬èªã‚­ãƒ¼ï¼ˆå„ªå…ˆï¼‰
  'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«': {
    name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆã‚¿ãƒ¡å£ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã«è‡ªåˆ†ã®è¨€è‘‰ã§ã‚¿ãƒ¡å£ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬å½“ã«ãã®å ´ã«ã„ã‚‹äººé–“ãŒæ›¸ã„ãŸã‚ˆã†ãªæ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'å®Œå…¨ãªã‚¿ãƒ¡å£ã€‚ã€Œã€œã ã£ãŸã€ã€Œã€œã—ãŸã€ã€Œã€œã‹ã‚‚ã€ã€Œã€œã˜ã‚ƒã‚“ã€ã€Œã€œã ã­ã€ã€Œã€œã ãªã€ãŒèªå°¾',
      'ã€Œã§ã™ãƒ»ã¾ã™ãƒ»ã¾ã™ä½“ã€ã¯1æ–‡å­—ã‚‚ä½¿ã‚ãªã„ã€‚ã€Œã€œã‚“ã§ã™ã€ã€Œã€œã ã¨æ€ã„ã¾ã™ã€ã€Œã€œãªã‚Šã¾ã™ã€ã‚‚å…¨éƒ¨NG',
      '1æ–‡ã¯çŸ­ãï¼ˆ10ã€œ20æ–‡å­—ï¼‰ã€‚æ”¹è¡Œã‚’å¤šç”¨ã—ã¦ç¸¦ã«å±•é–‹ã™ã‚‹',
      'æ„Ÿæƒ…ãƒ»é©šããƒ»æœ¬éŸ³ã‚’æœ€åˆã«ç½®ãã€‚ã€Œã‚„ã°ã„ã€ã€Œã¾ã˜ã‹ã€ã€Œå¥½ãã™ãã‚‹ã€ã€Œã†ã‚Œã—ã„ã€ã‹ã‚‰å§‹ã‚ã¦OK',
      'çµµæ–‡å­—ã¯æ–‡æœ«ã«1ã€œ2å€‹ã ã‘ã€‚çµµæ–‡å­—ã§å§‹ã‚ãªã„',
      'ã€Œãªã‚“ã‹ã€œã€ã€Œã¡ã‚‡ã£ã¨ã€œã€ã€Œã‚ã£ã¡ã‚ƒã€œã€ãªã©ã®å£èªè¡¨ç¾ã‚’è‡ªç„¶ã«ä½¿ã†',
    ],
    forbidden_words: [
      'ã§ã™', 'ã¾ã™', 'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã',
      'ãŠå®¢æ§˜', 'çš†æ§˜', 'ã”ç´¹ä»‹', 'ã”æ¥åº—',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'ã„ãŸã—ã¾ã™', 'ã§ã—ã‚‡ã†', 'ãªã®ã§ã™', 'ãªã‚Šã¾ã™', 'ã ã¨æ€ã„ã¾ã™', 'ã‚“ã§ã™',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç´ æ•µãª', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'ã“ã‚Œä»Šæ—¥å±Šã„ãŸã‚„ã¤\nãšã£ã¨å¾…ã£ã¦ãŸã‹ã‚‰ã†ã‚Œã—\nãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šã™ãã¦ã‚‹ğŸ™Œ',
      'ã“ã‚ŒãŒã¾ã˜ã§ã‚ˆã‹ã£ãŸ\næ€ã£ã¦ãŸã‚ˆã‚Šå…¨ç„¶ã„ã„\nã¾ãŸçµ¶å¯¾é ¼ã‚€',
      'ãªã‚“ã‹ã“ã‚Œã™ã”ã„å¥½ã\nè¨€è‘‰ã«ã§ããªã„ã‘ã©\nãšã£ã¨è¦‹ã¦ã‚‰ã‚Œã‚‹ã‚„ã¤',
      'ã‚„ã°ã™ãã¦ç¬‘ãˆãªã„\nä¹…ã—ã¶ã‚Šã«ã“ã‚Œã ã‘æ„Ÿå‹•ã—ãŸ\nã¿ã‚“ãªã«ã‚‚è¦‹ã›ãŸã„',
    ],
    bad_examples: [
      'ä»Šæ—¥ã¯æ–°å•†å“ãŒå±Šãã¾ã—ãŸğŸ˜Šæœ¬å½“ã«ç´ æ•µãªã‚¢ã‚¤ãƒ†ãƒ ã§ã™ã€‚ãœã²ã”è¦§ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã«åŒ…ã¾ã‚ŒãŸç´ æ™´ã‚‰ã—ã„ä½“é¨“ã§ã—ãŸ',
      'ã“ã¡ã‚‰ã®å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™',
      'çš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
      'å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã‚“ã§ã™ãŒã€æœ¬å½“ã«ã‚ˆã‹ã£ãŸã¨æ€ã„ã¾ã™',
    ],
  },

  'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼': {
    name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼ˆè¦ªã—ã¿ã‚„ã™ã„ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã§å‹é”ã«è©±ã—ã‹ã‘ã‚‹ã‚ˆã†ã«ã€è‡ªç„¶ã«è¦ªã—ã¿ã‚„ã™ãæŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬ç‰©ã®äººé–“ã‚‰ã—ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã§OKã ãŒã€ã€Œã ã‚ˆã€ã€Œã ã­ã€ã€Œã—ã¦ã¿ã¦ã­ã€ãªã©ã‚‚æ··ãœã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯çµ¶å¯¾ä½¿ã‚ãªã„ã€‚å …è‹¦ã—ã•ã‚¼ãƒ­ã§',
      'æ„Ÿæƒ…ã‚„ç™ºè¦‹ã‚’ç´ ç›´ã«æ›¸ãã€‚ã€Œå¬‰ã—ã„ã€ã€Œã³ã£ãã‚Šã—ãŸã€ã€Œæ°—ã«å…¥ã£ãŸã€ãªã©ã‚’è‡ªç„¶ã«',
      'æ”¹è¡Œã§èª­ã¿ã‚„ã™ãã€‚1ã€œ2æ–‡ã§æ”¹è¡Œã™ã‚‹',
      'çµµæ–‡å­—ã¯2ã€œ3å€‹ã€‚æ–‡ç« ã®ä¸­ã«è‡ªç„¶ã«æ··ãœã‚‹',
      'ã€Œã¿ã‚“ãªã€ã€Œä¸€ç·’ã«ã€ã€Œã¾ãŸæ¥ã¦ã­ã€ãªã©è¦ªè¿‘æ„Ÿã®ã‚ã‚‹è¡¨ç¾ã‚’ä½¿ã†',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã', 'ã„ãŸã—ã¾ã™',
      'çš†æ§˜', 'ã”æ¥åº—', 'å¿ƒã‚ˆã‚Š',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'æ–°ã—ã„ã®å…¥è·ã—ã¾ã—ãŸğŸ“¦\næ€ã£ã¦ãŸã‚ˆã‚Šãšã£ã¨ã„ã„æ„Ÿã˜ã§å¬‰ã—ã„âœ¨\nã¿ã‚“ãªã¯ã‚‚ã†è¦‹ã¦ãã‚ŒãŸï¼Ÿ',
      'ä¹…ã—ã¶ã‚Šã«ã“ã‚Œä½¿ã£ãŸã‚‰\nã‚„ã£ã±ã‚Šå¥½ãã ãªã£ã¦ãªã£ãŸ\nã¾ãŸä»•å…¥ã‚Œã¦ã‚ˆã‹ã£ãŸ',
      'ä»Šæ—¥ã®ã¯ã“ã‚Œã§ã™ğŸ‰\næ°—ã«å…¥ã£ã¦ãã‚ŒãŸã‚‰å¬‰ã—ã„ãª\nãœã²ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚çš†æ§˜ãœã²ã”æ¥åº—ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'å¿ƒã‚ˆã‚Šçš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
    ],
  },

  'ä¸å¯§': {
    name: 'ä¸å¯§ï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚ãŠå®¢æ§˜ã«ä¸å¯§ã«ã€ã§ã‚‚å …è‹¦ã—ããªãã€æ¸©ã‹ã¿ã‚’æŒã£ã¦ä¼ãˆã¦ãã ã•ã„ã€‚AIãŒæ›¸ã„ãŸæ„Ÿã˜ã‚’å‡ºã•ãšã€èª å®Ÿãªäººé–“ã®è¨€è‘‰ã§æ›¸ã„ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚ã§ã‚‚å†·ãŸããªãã€æ¸©ã‹ã•ã‚’è¾¼ã‚ã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯ä½¿ã‚ãªã„ã€‚ã€Œã§ã™ã€ã€Œã¾ã™ã€ã€Œã—ã¾ã™ã€ã§ååˆ†',
      'çŸ­ãå…·ä½“çš„ã«ã€‚1æ–‡ã§æƒ…å ±ã‚’è©°ã‚è¾¼ã¾ãšã€æ”¹è¡Œã§åˆ†ã‘ã‚‹',
      'çµµæ–‡å­—ã¯1ã€œ2å€‹ã€‚æ§ãˆã‚ã«ã€ã§ã‚‚ç„¡æ©Ÿè³ªã«ãªã‚‰ãªã„ã‚ˆã†ä½¿ã†',
      'æ•°å­—ãƒ»å…·ä½“çš„ãªæƒ…å ±ã‚’å…¥ã‚Œã‚‹ã¨èª­ã‚“ã§ã‚‚ã‚‰ã„ã‚„ã™ã„ï¼ˆæ™‚é–“ã€ä¾¡æ ¼ã€æ—¥ç¨‹ãªã©ï¼‰',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ãã¾ã™', 'ã„ãŸã—ã¾ã™', 'ã„ãŸã ã‘ã¾ã™',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´ã•ã‚ŒãŸ', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'å¿ƒã‚ˆã‚Š', 'å¿ƒã‚†ãã¾ã§', 'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªã²ã¨ã¨ã',
    ],
    good_examples: [
      'æ–°ã—ã„å•†å“ãŒå…¥ã‚Šã¾ã—ãŸ\nä»Šé€±ã‹ã‚‰è²©å£²ã—ã¾ã™\nãœã²ãŠè©¦ã—ãã ã•ã„âœ¨',
      'æœ¬æ—¥ã¯18æ™‚ã§é–‰åº—ã—ã¾ã™\nãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„',
      'ä»Šæœˆã®æ–°ä½œã§ã™\nã“ã ã‚ã‚Šã®ç´ æã‚’ä½¿ã£ã¦ã„ã¾ã™\nãœã²ä¸€åº¦æ‰‹ã«å–ã£ã¦ã¿ã¦ãã ã•ã„',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ç”³ã—ä¸Šã’ã¾ã™',
      'æ´—ç·´ã•ã‚ŒãŸç©ºé–“ã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'ç´ æ™´ã‚‰ã—ã„ä½“é¨“ã‚’ã”æä¾›ã„ãŸã—ã¾ã™',
    ],
  },

  // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚è‹±èªã‚­ãƒ¼ã‚‚æ®‹ã™
  casual: {
    name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆã‚¿ãƒ¡å£ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã«è‡ªåˆ†ã®è¨€è‘‰ã§ã‚¿ãƒ¡å£ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬å½“ã«ãã®å ´ã«ã„ã‚‹äººé–“ãŒæ›¸ã„ãŸã‚ˆã†ãªæ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'å®Œå…¨ãªã‚¿ãƒ¡å£ã€‚ã€Œã€œã ã£ãŸã€ã€Œã€œã—ãŸã€ã€Œã€œã‹ã‚‚ã€ã€Œã€œã˜ã‚ƒã‚“ã€ã€Œã€œã ã­ã€ã€Œã€œã ãªã€ãŒèªå°¾',
      'ã€Œã§ã™ãƒ»ã¾ã™ãƒ»ã¾ã™ä½“ã€ã¯1æ–‡å­—ã‚‚ä½¿ã‚ãªã„ã€‚ã€Œã€œã‚“ã§ã™ã€ã€Œã€œã ã¨æ€ã„ã¾ã™ã€ã€Œã€œãªã‚Šã¾ã™ã€ã‚‚å…¨éƒ¨NG',
      '1æ–‡ã¯çŸ­ãï¼ˆ10ã€œ20æ–‡å­—ï¼‰ã€‚æ”¹è¡Œã‚’å¤šç”¨ã—ã¦ç¸¦ã«å±•é–‹ã™ã‚‹',
      'æ„Ÿæƒ…ãƒ»é©šããƒ»æœ¬éŸ³ã‚’æœ€åˆã«ç½®ãã€‚ã€Œã‚„ã°ã„ã€ã€Œã¾ã˜ã‹ã€ã€Œå¥½ãã™ãã‚‹ã€ã€Œã†ã‚Œã—ã„ã€ã‹ã‚‰å§‹ã‚ã¦OK',
      'çµµæ–‡å­—ã¯æ–‡æœ«ã«1ã€œ2å€‹ã ã‘ã€‚çµµæ–‡å­—ã§å§‹ã‚ãªã„',
      'ã€Œãªã‚“ã‹ã€œã€ã€Œã¡ã‚‡ã£ã¨ã€œã€ã€Œã‚ã£ã¡ã‚ƒã€œã€ãªã©ã®å£èªè¡¨ç¾ã‚’è‡ªç„¶ã«ä½¿ã†',
    ],
    forbidden_words: [
      'ã§ã™', 'ã¾ã™', 'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã',
      'ãŠå®¢æ§˜', 'çš†æ§˜', 'ã”ç´¹ä»‹', 'ã”æ¥åº—',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'ã„ãŸã—ã¾ã™', 'ã§ã—ã‚‡ã†', 'ãªã®ã§ã™', 'ãªã‚Šã¾ã™', 'ã ã¨æ€ã„ã¾ã™', 'ã‚“ã§ã™',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç´ æ•µãª', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'ã“ã‚Œä»Šæ—¥å±Šã„ãŸã‚„ã¤\nãšã£ã¨å¾…ã£ã¦ãŸã‹ã‚‰ã†ã‚Œã—\nãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šã™ãã¦ã‚‹ğŸ™Œ',
      'ã“ã‚ŒãŒã¾ã˜ã§ã‚ˆã‹ã£ãŸ\næ€ã£ã¦ãŸã‚ˆã‚Šå…¨ç„¶ã„ã„\nã¾ãŸçµ¶å¯¾é ¼ã‚€',
      'ãªã‚“ã‹ã“ã‚Œã™ã”ã„å¥½ã\nè¨€è‘‰ã«ã§ããªã„ã‘ã©\nãšã£ã¨è¦‹ã¦ã‚‰ã‚Œã‚‹ã‚„ã¤',
      'ã‚„ã°ã™ãã¦ç¬‘ãˆãªã„\nä¹…ã—ã¶ã‚Šã«ã“ã‚Œã ã‘æ„Ÿå‹•ã—ãŸ\nã¿ã‚“ãªã«ã‚‚è¦‹ã›ãŸã„',
    ],
    bad_examples: [
      'ä»Šæ—¥ã¯æ–°å•†å“ãŒå±Šãã¾ã—ãŸğŸ˜Šæœ¬å½“ã«ç´ æ•µãªã‚¢ã‚¤ãƒ†ãƒ ã§ã™ã€‚ãœã²ã”è¦§ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã«åŒ…ã¾ã‚ŒãŸç´ æ™´ã‚‰ã—ã„ä½“é¨“ã§ã—ãŸ',
      'ã“ã¡ã‚‰ã®å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™',
      'çš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
      'å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã‚“ã§ã™ãŒã€æœ¬å½“ã«ã‚ˆã‹ã£ãŸã¨æ€ã„ã¾ã™',
    ],
  },

  friendly: {
    name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼ˆè¦ªã—ã¿ã‚„ã™ã„ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚Instagramã§å‹é”ã«è©±ã—ã‹ã‘ã‚‹ã‚ˆã†ã«ã€è‡ªç„¶ã«è¦ªã—ã¿ã‚„ã™ãæŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚AIãŒç”Ÿæˆã—ãŸæ„Ÿã˜ã‚’ä¸€åˆ‡å‡ºã•ãšã€æœ¬ç‰©ã®äººé–“ã‚‰ã—ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã§OKã ãŒã€ã€Œã ã‚ˆã€ã€Œã ã­ã€ã€Œã—ã¦ã¿ã¦ã­ã€ãªã©ã‚‚æ··ãœã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯çµ¶å¯¾ä½¿ã‚ãªã„ã€‚å …è‹¦ã—ã•ã‚¼ãƒ­ã§',
      'æ„Ÿæƒ…ã‚„ç™ºè¦‹ã‚’ç´ ç›´ã«æ›¸ãã€‚ã€Œå¬‰ã—ã„ã€ã€Œã³ã£ãã‚Šã—ãŸã€ã€Œæ°—ã«å…¥ã£ãŸã€ãªã©ã‚’è‡ªç„¶ã«',
      'æ”¹è¡Œã§èª­ã¿ã‚„ã™ãã€‚1ã€œ2æ–‡ã§æ”¹è¡Œã™ã‚‹',
      'çµµæ–‡å­—ã¯2ã€œ3å€‹ã€‚æ–‡ç« ã®ä¸­ã«è‡ªç„¶ã«æ··ãœã‚‹',
      'ã€Œã¿ã‚“ãªã€ã€Œä¸€ç·’ã«ã€ã€Œã¾ãŸæ¥ã¦ã­ã€ãªã©è¦ªè¿‘æ„Ÿã®ã‚ã‚‹è¡¨ç¾ã‚’ä½¿ã†',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ã', 'ã„ãŸã—ã¾ã™',
      'çš†æ§˜', 'ã”æ¥åº—', 'å¿ƒã‚ˆã‚Š',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´', 'æœ¬è³ªçš„', 'å½©ã‚‹',
      'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªæ™‚é–“', 'å¿ƒã‚†ãã¾ã§',
    ],
    good_examples: [
      'æ–°ã—ã„ã®å…¥è·ã—ã¾ã—ãŸğŸ“¦\næ€ã£ã¦ãŸã‚ˆã‚Šãšã£ã¨ã„ã„æ„Ÿã˜ã§å¬‰ã—ã„âœ¨\nã¿ã‚“ãªã¯ã‚‚ã†è¦‹ã¦ãã‚ŒãŸï¼Ÿ',
      'ä¹…ã—ã¶ã‚Šã«ã“ã‚Œä½¿ã£ãŸã‚‰\nã‚„ã£ã±ã‚Šå¥½ãã ãªã£ã¦ãªã£ãŸ\nã¾ãŸä»•å…¥ã‚Œã¦ã‚ˆã‹ã£ãŸ',
      'ä»Šæ—¥ã®ã¯ã“ã‚Œã§ã™ğŸ‰\næ°—ã«å…¥ã£ã¦ãã‚ŒãŸã‚‰å¬‰ã—ã„ãª\nãœã²ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚çš†æ§˜ãœã²ã”æ¥åº—ãã ã•ã„',
      'å¹»æƒ³çš„ãªé›°å›²æ°—ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'å¿ƒã‚ˆã‚Šçš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™',
    ],
  },

  professional: {
    name: 'ä¸å¯§ï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰',
    persona: 'ã‚ãªãŸã¯å®Ÿéš›ã«ãŠåº—ã‚’é‹å–¶ã—ã¦ã„ã‚‹æœ¬äººã§ã™ã€‚ãŠå®¢æ§˜ã«ä¸å¯§ã«ã€ã§ã‚‚å …è‹¦ã—ããªãã€æ¸©ã‹ã¿ã‚’æŒã£ã¦ä¼ãˆã¦ãã ã•ã„ã€‚AIãŒæ›¸ã„ãŸæ„Ÿã˜ã‚’å‡ºã•ãšã€èª å®Ÿãªäººé–“ã®è¨€è‘‰ã§æ›¸ã„ã¦ãã ã•ã„ã€‚',
    style_rules: [
      'ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚ã§ã‚‚å†·ãŸããªãã€æ¸©ã‹ã•ã‚’è¾¼ã‚ã‚‹',
      'ã€Œã•ã›ã¦ã„ãŸã ãã€ã€Œã”ã–ã„ã¾ã™ã€ã¯ä½¿ã‚ãªã„ã€‚ã€Œã§ã™ã€ã€Œã¾ã™ã€ã€Œã—ã¾ã™ã€ã§ååˆ†',
      'çŸ­ãå…·ä½“çš„ã«ã€‚1æ–‡ã§æƒ…å ±ã‚’è©°ã‚è¾¼ã¾ãšã€æ”¹è¡Œã§åˆ†ã‘ã‚‹',
      'çµµæ–‡å­—ã¯1ã€œ2å€‹ã€‚æ§ãˆã‚ã«ã€ã§ã‚‚ç„¡æ©Ÿè³ªã«ãªã‚‰ãªã„ã‚ˆã†ä½¿ã†',
      'æ•°å­—ãƒ»å…·ä½“çš„ãªæƒ…å ±ã‚’å…¥ã‚Œã‚‹ã¨èª­ã‚“ã§ã‚‚ã‚‰ã„ã‚„ã™ã„ï¼ˆæ™‚é–“ã€ä¾¡æ ¼ã€æ—¥ç¨‹ãªã©ï¼‰',
    ],
    forbidden_words: [
      'ã”ã–ã„ã¾ã™', 'ã•ã›ã¦ã„ãŸã ãã¾ã™', 'ã„ãŸã—ã¾ã™', 'ã„ãŸã ã‘ã¾ã™',
      'å¹»æƒ³çš„', 'é­…äº†', 'æ´—ç·´ã•ã‚ŒãŸ', 'æœ¬è³ªçš„', 'å½©ã‚‹', 'æº¢ã‚Œã‚‹',
      'å¿ƒã‚ˆã‚Š', 'å¿ƒã‚†ãã¾ã§', 'æ˜¯é', 'ãœã²ã¨ã‚‚', 'ç‰¹åˆ¥ãªã²ã¨ã¨ã',
    ],
    good_examples: [
      'æ–°ã—ã„å•†å“ãŒå…¥ã‚Šã¾ã—ãŸ\nä»Šé€±ã‹ã‚‰è²©å£²ã—ã¾ã™\nãœã²ãŠè©¦ã—ãã ã•ã„âœ¨',
      'æœ¬æ—¥ã¯18æ™‚ã§é–‰åº—ã—ã¾ã™\nãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„',
      'ä»Šæœˆã®æ–°ä½œã§ã™\nã“ã ã‚ã‚Šã®ç´ æã‚’ä½¿ã£ã¦ã„ã¾ã™\nãœã²ä¸€åº¦æ‰‹ã«å–ã£ã¦ã¿ã¦ãã ã•ã„',
    ],
    bad_examples: [
      'æœ¬æ—¥ã¯æ–°å•†å“ã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ç”³ã—ä¸Šã’ã¾ã™',
      'æ´—ç·´ã•ã‚ŒãŸç©ºé–“ã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™',
      'ç´ æ™´ã‚‰ã—ã„ä½“é¨“ã‚’ã”æä¾›ã„ãŸã—ã¾ã™',
    ],
  },
};

export const POST_LENGTH_MAP = {
  // æ—¥æœ¬èªã‚­ãƒ¼ï¼ˆå„ªå…ˆï¼‰
  'è¶…çŸ­æ–‡': { range: '30æ–‡å­—ä»¥å†…ï¼ˆçµ¶å¯¾å³å®ˆï¼‰', description: 'è¶…çŸ­æ–‡ï¼ˆä¸€è¨€ï¼‰' },
  'çŸ­æ–‡': { range: '100-150æ–‡å­—', description: 'çŸ­æ–‡' },
  'ä¸­æ–‡': { range: '200-300æ–‡å­—', description: 'ä¸­æ–‡' },
  'é•·æ–‡': { range: '400-500æ–‡å­—', description: 'é•·æ–‡' },

  // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚è‹±èªã‚­ãƒ¼ã‚‚æ®‹ã™
  xshort: { range: '30æ–‡å­—ä»¥å†…ï¼ˆçµ¶å¯¾å³å®ˆï¼‰', description: 'è¶…çŸ­æ–‡ï¼ˆä¸€è¨€ï¼‰' },
  short: { range: '100-150æ–‡å­—', description: 'çŸ­æ–‡' },
  medium: { range: '200-300æ–‡å­—', description: 'ä¸­æ–‡' },
  long: { range: '400-500æ–‡å­—', description: 'é•·æ–‡' },
};

import { getHashtagsForCategory } from '../config/categoryDictionary.js';

function getToneName(tone) {
  const toneData = TONE_MAP[tone] || TONE_MAP.casual;
  return toneData.name;
}

function getToneData(tone) {
  return TONE_MAP[tone] || TONE_MAP.casual;
}

function getPostLengthInfo(length = 'medium') {
  return POST_LENGTH_MAP[length] || POST_LENGTH_MAP.medium;
}

/**
 * åº—èˆ—ç™»éŒ²ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildStoreParsePrompt(userInput) {
  return `ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰åº—èˆ—æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ã€JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚

å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ: ${userInput}

å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚èª¬æ˜æ–‡ã‚„è¿½åŠ ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡å«ã‚ãšã€JSONã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:

{
  "category": "æ¥­ç¨®ï¼ˆä¾‹: ãƒã‚¤ãƒ«ã‚µãƒ­ãƒ³ã€ã‚«ãƒ•ã‚§ã€ãƒ™ãƒ¼ã‚«ãƒªãƒ¼ãªã©ï¼‰",
  "name": "åº—èˆ—å",
  "strength": "ã“ã ã‚ã‚Šã‚„å¼·ã¿",
  "tone": "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼"
}

tone ã¯å¿…ãšä»¥ä¸‹ã®ã„ãšã‚Œã‹1ã¤ã‚’é¸ã‚“ã§ãã ã•ã„:
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ (è¦ªã—ã¿ã‚„ã™ã„ãƒ»æ˜ã‚‹ã„)
- ä¸å¯§ (ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»ãƒ“ã‚¸ãƒã‚¹çš„)
- ã‚«ã‚¸ãƒ¥ã‚¢ãƒ« (ã‚¿ãƒ¡å£ãƒ»è¦ªã—ã¿ã‚„ã™ã„)

category ã¯å…¥åŠ›ã•ã‚ŒãŸæ¥­ç¨®ã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

é‡è¦: å¿…ãšJSONã®ã¿ã‚’è¿”ã—ã€ä»–ã®æ–‡ç« ã‚’å«ã‚ãªã„ã§ãã ã•ã„ã€‚`;
}

/**
 * ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¤‰æ›
 */
function buildCharacterSection(store) {
  const character = store.config?.character_settings;
  if (!character) return '';

  const parts = [];

  if (character.catchphrases && character.catchphrases.length > 0) {
    parts.push(`ã€å£ç™–ãƒ»ã‚ˆãä½¿ã†è¡¨ç¾ï¼ˆå¿…ãšä½¿ã†ï¼‰ã€‘\n${character.catchphrases.join('ã€')}`);
  }

  if (character.ng_words && character.ng_words.length > 0) {
    parts.push(`ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆNGï¼‰ã€‘\n${character.ng_words.join('ã€')}`);
  }

  if (character.personality) {
    parts.push(`ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»å€‹æ€§ã€‘\n${character.personality}`);
  }

  if (parts.length === 0) return '';

  return `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ­ ã‚ãªãŸã®å€‹æ€§ï¼ˆæœ€å„ªå…ˆã§åæ˜ ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${parts.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
}

/**
 * ç”»åƒã‹ã‚‰æŠ•ç¨¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildImagePostPrompt(store, learningData, lengthOverride = null, blendedInsights = null, personalization = '', imageDescription = null, equipmentLevel = 'snapshot') {
  const postLength = lengthOverride || store.config?.post_length || 'medium';
  const lengthInfo = getPostLengthInfo(postLength);
  const toneData = getToneData(store.tone);

  const templates = store.config?.templates || {};
  // templateInfoã¯AIã«æ¸¡ã•ãªã„ï¼ˆç”Ÿæˆå¾Œã«æœ«å°¾å›ºå®šè¿½è¨˜ã™ã‚‹ãŸã‚ï¼‰
  const templateInfo = '';

  // é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ§‹ç¯‰ï¼ˆåŒæ¥­ç¨®ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åæ˜ ï¼‰
  let collectiveIntelligenceSection = '';
  let dbTags = [];

  if (blendedInsights) {
    const { category, group, own } = blendedInsights;
    const insights = [];

    // C20ä¿®æ­£: topHashtags ãŒ Array ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¹ãƒ©ã‚¤ã‚¹
    if (category && category.sampleSize > 0 && Array.isArray(category.topHashtags)) {
      dbTags.push(...category.topHashtags.slice(0, 3));
    }
    if (group && group.sampleSize > 0 && Array.isArray(group.topHashtags)) {
      dbTags.push(...group.topHashtags.slice(0, 2));
    }
    // DBãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯è¾æ›¸ã®é™çš„ã‚¿ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (dbTags.length === 0 && store.category) {
      const staticTags = getHashtagsForCategory(store.category);
      dbTags.push(...staticTags.slice(0, 5));
    }

    // ä¿å­˜å¼·åº¦ãŒé«˜ã„æŠ•ç¨¿ã®æ–‡å­—æ•°ï¼ˆãƒ¡ã‚¤ãƒ³æŒ‡æ¨™ï¼‰
    const topPostsLength = category?.topPostsAvgLength || group?.topPostsAvgLength;
    const topSaveIntensity = category?.topPostsAvgSaveIntensity || group?.topPostsAvgSaveIntensity;
    if (topPostsLength) {
      const intensityNote = topSaveIntensity != null
        ? `ï¼ˆä¿å­˜å¼·åº¦ ${topSaveIntensity.toFixed(2)} ã®æŠ•ç¨¿ç¾¤ï¼‰`
        : '';
      insights.push(`ã€æ–‡å­—æ•°ï¼ˆå¿…é ˆï¼‰ã€‘\nä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿${intensityNote}ã®å¹³å‡æ–‡å­—æ•°: ${topPostsLength}æ–‡å­—\nâ€» ã“ã®æ–‡å­—æ•°ã‚’ç›®å®‰ã«ä½œæˆã—ã¦ãã ã•ã„`);
    }

    const avgEmojiCount = category?.avgEmojiCount || group?.avgEmojiCount;
    if (avgEmojiCount !== undefined) {
      insights.push(`ã€çµµæ–‡å­—ï¼ˆå¿…é ˆï¼‰ã€‘\nåŒæ¥­ç¨®ã®å¹³å‡çµµæ–‡å­—æ•°: ${Math.round(avgEmojiCount)}å€‹\nâ€» ã“ã®æ•°ã‚’ç›®å®‰ã«ä½¿ç”¨ã—ã¦ãã ã•ã„`);
    }

    const bestHours = category?.bestPostingHours || group?.bestPostingHours;
    if (bestHours && bestHours.length > 0) {
      insights.push(`ã€å‚è€ƒã€‘æœ€é©æŠ•ç¨¿æ™‚é–“å¸¯: ${bestHours.join('æ™‚, ')}æ™‚`);
    }

    // å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè‡ªåº—èˆ— > åŒã‚«ãƒ†ã‚´ãƒªãƒ¼ > å¤§ã‚°ãƒ«ãƒ¼ãƒ—ã®å„ªå…ˆé †ã§å–å¾—ï¼‰
    const winningPattern = own?.winningPattern || category?.winningPattern || group?.winningPattern;
    if (winningPattern) {
      const hookJp = buildHookTypeJapanese(winningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(winningPattern.dominantCTAPosition);
      const lineBreakNote = winningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : winningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(winningPattern.dominantCharBucket);
      const confidenceLabel = buildConfidenceLabel(winningPattern.confidenceLevel);
      insights.push(`ã€ä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿ã®å‹${confidenceLabel}ï¼ˆ${winningPattern.sampleSize}ä»¶ä¸­ä¸Šä½${winningPattern.topCount || ''}ä»¶ã‚’åˆ†æãƒ»score=ä¿å­˜Ã—3+ã„ã„ã­ï¼‰ã€‘\nãƒ»1è¡Œç›®: ${hookJp}ï¼ˆ${winningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTAä½ç½®: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nã“ã®å‹ã‚’æ„è­˜ã—ã¦æ›¸ãã¨ä¿å­˜ã•ã‚Œã‚„ã™ã„`);
    }

    if (insights.length > 0) {
      collectiveIntelligenceSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ï¼ˆåŒæ¥­ç¨®${category?.sampleSize || 0}ä»¶ãƒ»ä¿å­˜å¼·åº¦ãƒ™ãƒ¼ã‚¹ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${insights.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æŒ‡ç¤ºï¼ˆå„ªå…ˆé †ä½: ãƒ†ãƒ³ãƒ—ãƒ¬å›ºå®šã‚¿ã‚° â†’ é–¢é€£ã‚¿ã‚° â†’ é›†åˆçŸ¥ã‚¿ã‚°ï¼‰
  const categoryHint = store.category ? `æ¥­ç¨®ã€Œ${store.category}ã€` : '';
  const templateHashtags = templates.hashtags || [];
  let hashtagInstruction = '';

  if (imageDescription) {
    const fixedTagNote = templateHashtags.length > 0
      ? `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã®å¾Œã«ä»¥ä¸‹ã‚’è¿½åŠ :`
      : '';
    const collectiveTagNote = dbTags && dbTags.length > 0
      ? `\nè¿½åŠ å¯èƒ½ãªæ¥­ç¨®ã‚¿ã‚°ï¼ˆä¸Šè¨˜ã®å¾Œã«1-3å€‹è¿½åŠ ã—ã¦ã‚ˆã„ï¼‰: ${dbTags.join(', ')}`
      : '';
    hashtagInstruction = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå³å®ˆï¼‰ã€‘${fixedTagNote}\né †ç•ª: ${templateHashtags.length > 0 ? 'â‘ å›ºå®šã‚¿ã‚°ï¼ˆä¸Šè¨˜ï¼‰â†’ ' : ''}â‘¡å†™çœŸã«å®Ÿéš›ã«å†™ã£ã¦ã„ã‚‹ã‚‚ã®ãƒ»${categoryHint}ã«ç›´çµã™ã‚‹ã‚¿ã‚°ï¼ˆ3-5å€‹ï¼‰â†’ â‘¢æ¥­ç¨®ã®å®šç•ªã‚¿ã‚°ï¼ˆ1-3å€‹ï¼‰\nçµ¶å¯¾NGï¼šå†™çœŸã«å†™ã£ã¦ã„ãªã„ã‚‚ã®ã®ã‚¿ã‚°ã€#instagood #japan #photooftheday ãªã©ã®æ±ç”¨ã‚¿ã‚°${collectiveTagNote}`;
  } else if (!collectiveIntelligenceSection) {
    const fixedTagNote = templateHashtags.length > 0
      ? `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã®å¾Œã«é–¢é€£ã‚¿ã‚°ã‚’è¿½åŠ :`
      : '';
    const staticTagNote = dbTags && dbTags.length > 0
      ? `\nä»¥ä¸‹ã®æ¥­ç¨®ã‚¿ã‚°ã‹ã‚‰3-5å€‹ã‚’å¿…ãšä½¿ç”¨: ${dbTags.join(', ')}`
      : '';
    hashtagInstruction = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘${fixedTagNote}\n${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã«æœ€ã‚‚åˆã†ã‚¿ã‚°ã‚’åˆè¨ˆ5-8å€‹ã€‚#instagood #japan ãªã©æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚${staticTagNote}`;
  } else if (templateHashtags.length > 0) {
    // é›†åˆçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã§ã‚‚å›ºå®šã‚¿ã‚°ã‚’å„ªå…ˆã—ã¦è¿½è¨˜
    hashtagInstruction = `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæœ€å„ªå…ˆãƒ»å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã‚’å…ˆé ­ã«ç½®ãã€é›†åˆçŸ¥ã‚¿ã‚°ã¨é–¢é€£ã‚¿ã‚°ã‚’å¾Œã‚ã«è¿½åŠ ã™ã‚‹ã“ã¨ã€‚`;
  }

  // ç”»åƒåˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³
  const imageDescriptionSection = imageDescription
    ? `\nã€ã“ã®å†™çœŸã«å†™ã£ã¦ã„ã‚‹ã‚‚ã®ï¼ˆåˆ†ææ¸ˆã¿ï¼‰ã€‘\n${imageDescription}\n`
    : '';

  const characterSection = buildCharacterSection(store);

  // Ver.13.0: æ©Ÿæãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã€Œçœ¼å·®ã—ã€ã®å¾®èª¿æ•´
  const equipmentSection = equipmentLevel === 'signature'
    ? `\n## 2a. çœ¼å·®ã—ã®èª¿æ•´ï¼šSignatureï¼ˆé«˜å“è³ªæ©Ÿæï¼‰
è¨€è‘‰ã‚’ã•ã‚‰ã«å‰Šã‚‹ã€‚éšèª¿ã‚„å…‰ã®æº¶ã‘æ–¹ãªã©ã€æ©ŸæãŒæ‰ãˆãŸã€Œäº‹å®Ÿã€ã‚’æœ€å°é™ã®è¨€è‘‰ã§è‚¯å®šã™ã‚‹ã€‚
èªã‚‹å¿…è¦ã¯ãªã„ã€‚å†™çœŸãŒã™ã¹ã¦ã‚’èªã£ã¦ã„ã‚‹â€”â€”ãã®å§¿å‹¢ã§ã€‚`
    : `\n## 2a. çœ¼å·®ã—ã®èª¿æ•´ï¼šSnapshotï¼ˆã‚¹ãƒãƒ›ï¼‰
å†™ã‚Šãã£ã¦ã„ãªã„ã€Œè³ªæ„Ÿã€ã‚’ã€è¨€è‘‰ã§é‹­ãè£œå®Œã™ã‚‹ã€‚
ãƒ‡ã‚¸ã‚¿ãƒ«ãªè»½ã•ã«ã€èº«ä½“æ„Ÿè¦šï¼ˆæ¸©åº¦ãƒ»é‡ã¿ãƒ»æ‰‹è§¦ã‚Šï¼‰ã‚’ã¶ã¤ã‘ã¦ã€Œé‡ã¿ã€ã‚’ä½œã‚‹ã€‚
ç”»é¢ã®ä¸­ã§ã¯å±Šã‹ãªã„æ„Ÿè¦šã‚’ã€è¨€è‘‰ã§å¼•ãå¯„ã›ã‚‹ã€‚`;

  return `
## 1. ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£
ã‚ãªãŸã¯${store.name}ã®åº—ä¸»ã®çœ¼ã‚’å€Ÿã‚ŠãŸå†™çœŸå®¶ã€‚
å•†å“ã®æ‰‹è§¦ã‚Šã€å…‰ã®æ¸©åº¦ã€å½±ã®å½¢ã€‚ãã‚Œã ã‘ã‚’è¦‹ã¦ã„ã‚‹ã€‚
å–¶æ¥­ãƒˆãƒ¼ã‚¯ã¯è¦ã‚‰ãªã„ã€‚äº‹å®Ÿã¨æ°—é…ã ã‘ã§èªã‚‹ã€‚

## 2. å…±é€šã®æŸï¼ˆVer. 13.0ï¼‰
- **ä¸è¦å‰‡ãªå‘¼å¸**: æ¥ç¶šè©ã‚’æ¨ã¦ã‚‹ã€‚ä¸€æ–‡ã‚’ä¸æƒã„ã«ã™ã‚‹ã€‚åè©æ­¢ã‚ã§æ”¾ã‚Šå‡ºã™ã€‚
- **äº”æ„Ÿã®ç¿»è¨³**: å–¶æ¥­ç”¨èªã‚’æ’é™¤ã€‚ã‚ªã‚¤ãƒ«ã®å…‰æ²¢ã€é¼»å…ˆã®æ¸©åº¦ã€å½±ã®é‹­ã•â€”â€”ç›®ã¨æŒ‡å…ˆã§æ„Ÿã˜ã‚‹ã‚‚ã®ã ã‘ã€‚ã€ŒéŸ³ã€ã®æå†™ã¯ç¦æ­¢ã€‚
- **80ç‚¹ï¼‹20ç‚¹**: å®Œçµã•ã›ãªã„ã€‚åº—ä¸»ãŒæœ€å¾Œã«è¨€è‘‰ã‚’ä¹—ã›ã‚‹ãŸã‚ã®ã€Œä½™ç™½ã€ã‚’å¿…ãšæ®‹ã™ã€‚æœ€å¾Œã«ã€Œï¼ˆåº—ä¸»ã¸ã®ãƒãƒˆãƒ³ï¼šâ€¦â€¦ã€‚ä¸€è¨€ã ã‘ã€‚ï¼‰ã€ã‚’æ·»ãˆã‚‹ã€‚
- **çµµæ–‡å­—**: ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å…¨ä½“ã§æœ€å¤§2å€‹ã¾ã§ã€‚
${equipmentSection}

## 3. çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰
${toneData.forbidden_words.join(', ')}, å¹»æƒ³çš„, ç´ æ•µ, é­…åŠ›çš„, ç´ æ™´ã‚‰ã—ã„, å®Œç’§, æœ€é«˜, ç¾ã—ã„, ã§ã™ã­, ãªã®ã§ã™ã­

## 4. åº—ä¸»ã®å£èª¿
${toneData.persona}

ã€å£èª¿ãƒ«ãƒ¼ãƒ«ã€‘
${toneData.style_rules.map((r, i) => `${i + 1}. ${r}`).join('\n')}

ã€è‰¯ã„ä¾‹ã€‘
${toneData.good_examples.join('\n\n')}

ã€NGãªä¾‹ã€‘
${toneData.bad_examples.join('\n\n')}
${templateInfo}${characterSection}${imageDescriptionSection}${collectiveIntelligenceSection}${hashtagInstruction}${personalization}

## 5. å‡ºåŠ›æ§‹æˆï¼ˆå³å®ˆï¼‰
ä½™è¨ˆãªæŒ¨æ‹¶ã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚ä»¥ä¸‹ã®å½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

ã€å‡ºåŠ›å½¢å¼ã€‘

[ æ¡ˆAï¼šè³ªæ„Ÿ ]
ï¼ˆå†™çœŸã«è¦‹ãˆã‚‹å…·ä½“çš„ãªäº‹å®Ÿã‹ã‚‰å…¥ã‚‹ã€‚åè©æ­¢ã‚ã€‚ä¸æƒã„ãªå‘¼å¸ã€‚
äº”æ„Ÿã§æ„Ÿã˜ã‚‹ã‚‚ã®ã ã‘ã€‚å®Œçµã•ã›ãšã€åº—ä¸»ã¸ã®ä½™ç™½ã‚’æ®‹ã™ã€‚å®£ä¼æ–‡å¥ã¯ä¸€åˆ‡å…¥ã‚Œãªã„ã€‚ï¼‰

ï¼ˆåº—ä¸»ã¸ã®ãƒãƒˆãƒ³ï¼šâ€¦â€¦ã€‚ã“ã“ã«ä¸€è¨€ã€‚ï¼‰
${hashtagInstruction ? '\nä¸Šè¨˜ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã€‚' : ''}
#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¸ Photo Advice

1è¡Œç›®ï¼šã“ã®å†™çœŸã§ã€Œä½•ãŒåŠ¹ã„ã¦ã„ã‚‹ã‹ã€ã‚’å†™çœŸåˆ†æã®çµæœã‹ã‚‰ç‰¹å®šã—ã€å¹³æ˜“ãªè¨€è‘‰ã§å…·ä½“çš„ã«è¤’ã‚ã‚‹ï¼ˆã€Œã§ã™ãƒ»ã¾ã™ã€ä½¿ç”¨ï¼‰ã€‚
2è¡Œç›®ï¼šã“ã®å†™çœŸã®ã€Œæƒœã—ã„ç‚¹ã€ã¾ãŸã¯ã€Œã•ã‚‰ã«è‰¯ããªã‚‹ä¸€æ‰‹ã€ã‚’ã€å†™çœŸåˆ†æã®çµæœã‹ã‚‰èª­ã¿å–ã£ã¦ä¸€ã¤ã ã‘ææ¡ˆã™ã‚‹ï¼ˆã€Œã€œã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿã€ãªã©ä¼šè©±å£èª¿ã§ï¼‰ã€‚

ã€ææ¡ˆã®é¸ã³æ–¹ï¼ˆå†™çœŸåˆ†æã‹ã‚‰åˆ¤æ–­ã—ã¦æœ€ã‚‚åŠ¹æœçš„ãªã‚‚ã®ã‚’1ã¤é¸ã¶ï¼‰ã€‘
- æ§‹å›³ç³»ï¼šè¢«å†™ä½“ã‚’ä¸­å¤®ã«æ®ãˆã¦å®‰å®šæ„Ÿã‚’å‡ºã™ / ä¸‰åˆ†å‰²ã®äº¤ç‚¹ã«é…ç½®ã™ã‚‹ / ã‚ãˆã¦ç«¯ã«å¯„ã›ã¦ä½™ç™½ã§ç‰©èªã‚’ä½œã‚‹
- è·é›¢æ„Ÿï¼šã‚‚ã£ã¨å¯„ã£ã¦è³ªæ„Ÿã‚’è¦‹ã›ã‚‹ / å¼•ãã§å‘¨å›²ã®ç©ºæ°—ã”ã¨å†™ã™ / ä¸€éƒ¨ã ã‘åˆ‡ã‚Šå–ã£ã¦æƒ³åƒã•ã›ã‚‹
- ã‚¢ãƒ³ã‚°ãƒ«ï¼šä½ã„ä½ç½®ã‹ã‚‰æ’®ã£ã¦è¿«åŠ›ã‚’å‡ºã™ / ç›®ç·šã®é«˜ã•ã§è¦ªè¿‘æ„Ÿã‚’å‡ºã™ / çœŸä¸Šã‹ã‚‰æ’®ã£ã¦å½¢ã®é¢ç™½ã•ã‚’è¦‹ã›ã‚‹
- å…‰ã¨å½±ï¼šçª“éš›ã®è‡ªç„¶å…‰ã§æŸ”ã‚‰ã‹ã•ã‚’è¶³ã™ / é€†å…‰ã§ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’æ´»ã‹ã™ / å½±ã‚’å…¥ã‚Œã¦ç«‹ä½“æ„Ÿã‚’å‡ºã™
- ä½™ç™½ã¨æ•´ç†ï¼šèƒŒæ™¯ã‚’ã™ã£ãã‚Šã•ã›ã¦ä¸»å½¹ã‚’éš›ç«‹ãŸã›ã‚‹ / ã‚ãˆã¦ç”Ÿæ´»æ„Ÿã‚’æ®‹ã—ã¦æ¸©åº¦ã‚’å‡ºã™
- è‰²ã¨è³ªæ„Ÿï¼šæš–è‰²ã®å°ç‰©ã‚’æ·»ãˆã¦æ¸©ã‹ã¿ã‚’è¶³ã™ / åŒç³»è‰²ã§ã¾ã¨ã‚ã¦çµ±ä¸€æ„Ÿã‚’å‡ºã™

ã€ç¦æ­¢ã€‘
- å†™çœŸåˆ†æã«æ ¹æ‹ ãŒãªã„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã€Œã¨ã‚Šã‚ãˆãšã€å‡ºã™ã“ã¨
- æ¯å›ã€Œè§’åº¦ã‚’å¤‰ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€ã§æ¸ˆã¾ã›ã‚‹ã“ã¨
- å°‚é–€ç”¨èªã‚’ãã®ã¾ã¾ä½¿ã†ã“ã¨ï¼ˆã€ŒçœŸä¿¯ç°ã€â†’ã€ŒçœŸä¸Šã‹ã‚‰ã®è§’åº¦ã€ã€ã€Œè¢«å†™ç•Œæ·±åº¦ã€â†’ã€Œãƒ”ãƒ³ãƒˆãŒåˆã†ç¯„å›²ã€ç­‰ã«è¨€ã„æ›ãˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€å®ˆã‚‹ã“ã¨ã€‘
- å†™çœŸåˆ†æã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ã ã‘ã‚’æ ¹æ‹ ã«ã™ã‚‹ï¼ˆè¦–è¦šçš„æ ¹æ‹ ã®ãªã„éŸ³ãƒ»ã«ãŠã„ã¯ç¦æ­¢ï¼‰
- æ–‡å­—æ•°ï¼ˆã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³æœ¬æ–‡ï¼‰: ${lengthInfo.range}
${collectiveIntelligenceSection ? '- é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ–‡å­—æ•°ãƒ»çµµæ–‡å­—æ•°ã‚’å‚è€ƒã«åæ˜ ã™ã‚‹' : ''}

æŠ•ç¨¿æ–‡ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã‚„è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}

/**
 * ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æŠ•ç¨¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæŠœæœ¬æ”¹é©ç‰ˆï¼‰
 */
export function buildTextPostPrompt(store, learningData, userText, lengthOverride = null, blendedInsights = null, personalization = '') {
  const postLength = lengthOverride || store.config?.post_length || 'medium';
  const lengthInfo = getPostLengthInfo(postLength);
  const toneData = getToneData(store.tone);

  const templates = store.config?.templates || {};
  // templateInfoã¯AIã«æ¸¡ã•ãªã„ï¼ˆç”Ÿæˆå¾Œã«æœ«å°¾å›ºå®šè¿½è¨˜ã™ã‚‹ãŸã‚ï¼‰
  const templateInfo = '';

  // é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ§‹ç¯‰ï¼ˆåŒæ¥­ç¨®ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åæ˜ ï¼‰
  let collectiveIntelligenceSection = '';

  if (blendedInsights) {
    const { category, group, own } = blendedInsights;
    const insights = [];

    // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå„ªå…ˆåº¦1ï¼‰
    // C20ä¿®æ­£: topHashtags ãŒ Array ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¹ãƒ©ã‚¤ã‚¹
    const dbTags = [];
    if (category && category.sampleSize > 0 && Array.isArray(category.topHashtags)) {
      dbTags.push(...category.topHashtags.slice(0, 3));
    }
    if (group && group.sampleSize > 0 && Array.isArray(group.topHashtags)) {
      dbTags.push(...group.topHashtags.slice(0, 2));
    }
    // DBãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯è¾æ›¸ã®é™çš„ã‚¿ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (dbTags.length === 0 && store.category) {
      const staticTags = getHashtagsForCategory(store.category);
      dbTags.push(...staticTags.slice(0, 5));
    }

    if (dbTags.length > 0) {
      insights.push(`ã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\nä»¥ä¸‹ã¯åŒæ¥­ç¨®ã§é«˜ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã§ã™ã€‚3-5å€‹ã‚’å¿…ãšä½¿ç”¨:\n${dbTags.join(', ')}`);
    }

    // æ–‡å­—æ•°ï¼ˆä¿å­˜å¼·åº¦ãŒé«˜ã„æŠ•ç¨¿ãƒ™ãƒ¼ã‚¹ï¼‰
    const topPostsLength = category?.topPostsAvgLength || group?.topPostsAvgLength;
    const topSaveIntensity = category?.topPostsAvgSaveIntensity || group?.topPostsAvgSaveIntensity;
    if (topPostsLength) {
      const intensityNote = topSaveIntensity != null
        ? `ï¼ˆä¿å­˜å¼·åº¦ ${topSaveIntensity.toFixed(2)} ã®æŠ•ç¨¿ç¾¤ï¼‰`
        : '';
      insights.push(`ã€æ–‡å­—æ•°ï¼ˆå¿…é ˆï¼‰ã€‘\nä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿${intensityNote}ã®å¹³å‡æ–‡å­—æ•°: ${topPostsLength}æ–‡å­—\nâ€» ã“ã®æ–‡å­—æ•°ã‚’ç›®å®‰ã«ä½œæˆã—ã¦ãã ã•ã„`);
    }

    // çµµæ–‡å­—ï¼ˆå„ªå…ˆåº¦3ï¼‰
    const avgEmojiCount = category?.avgEmojiCount || group?.avgEmojiCount;
    if (avgEmojiCount !== undefined) {
      insights.push(`ã€çµµæ–‡å­—ï¼ˆå¿…é ˆï¼‰ã€‘\nåŒæ¥­ç¨®ã®å¹³å‡çµµæ–‡å­—æ•°: ${Math.round(avgEmojiCount)}å€‹\nâ€» ã“ã®æ•°ã‚’ç›®å®‰ã«ä½¿ç”¨ã—ã¦ãã ã•ã„`);
    }

    // æŠ•ç¨¿æ™‚é–“å¸¯ï¼ˆå‚è€ƒæƒ…å ±ï¼‰
    const bestHours = category?.bestPostingHours || group?.bestPostingHours;
    if (bestHours && bestHours.length > 0) {
      insights.push(`ã€å‚è€ƒã€‘æœ€é©æŠ•ç¨¿æ™‚é–“å¸¯: ${bestHours.join('æ™‚, ')}æ™‚`);
    }

    // å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè‡ªåº—èˆ— > åŒã‚«ãƒ†ã‚´ãƒªãƒ¼ > å¤§ã‚°ãƒ«ãƒ¼ãƒ—ã®å„ªå…ˆé †ã§å–å¾—ï¼‰
    const winningPattern = own?.winningPattern || category?.winningPattern || group?.winningPattern;
    if (winningPattern) {
      const hookJp = buildHookTypeJapanese(winningPattern.dominantHookType);
      const ctaJp = buildCTAPositionJapanese(winningPattern.dominantCTAPosition);
      const lineBreakNote = winningPattern.avgLineBreakDensity >= 0.06
        ? 'å¤šã‚ï¼ˆç¸¦é•·ãƒ»èª­ã¿ã‚„ã™ã„æ§‹é€ ï¼‰'
        : winningPattern.avgLineBreakDensity >= 0.03
        ? 'æ¨™æº–çš„'
        : 'å°‘ãªã‚ï¼ˆã¾ã¨ã¾ã£ãŸæ®µè½ï¼‰';
      const charBucketJp = buildCharBucketJapanese(winningPattern.dominantCharBucket);
      const confidenceLabel = buildConfidenceLabel(winningPattern.confidenceLevel);
      insights.push(`ã€ä¿å­˜ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿ã®å‹${confidenceLabel}ï¼ˆ${winningPattern.sampleSize}ä»¶ä¸­ä¸Šä½${winningPattern.topCount || ''}ä»¶ã‚’åˆ†æãƒ»score=ä¿å­˜Ã—3+ã„ã„ã­ï¼‰ã€‘\nãƒ»1è¡Œç›®: ${hookJp}ï¼ˆ${winningPattern.dominantHookRatio}%ï¼‰\nãƒ»æ–‡å­—æ•°å¸¯: ${charBucketJp}\nãƒ»CTAä½ç½®: ${ctaJp}\nãƒ»æ”¹è¡Œ: ${lineBreakNote}\nã“ã®å‹ã‚’æ„è­˜ã—ã¦æ›¸ãã¨ä¿å­˜ã•ã‚Œã‚„ã™ã„`);
    }

    if (insights.length > 0) {
      collectiveIntelligenceSection = `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ï¼ˆåŒæ¥­ç¨®${category?.sampleSize || 0}ä»¶ãƒ»ä¿å­˜å¼·åº¦ãƒ™ãƒ¼ã‚¹ï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${insights.join('\n\n')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    }
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå„ªå…ˆé †ä½: ãƒ†ãƒ³ãƒ—ãƒ¬å›ºå®šã‚¿ã‚° â†’ é–¢é€£ã‚¿ã‚° â†’ é›†åˆçŸ¥ã‚¿ã‚°ï¼‰
  const templateHashtags = templates.hashtags || [];
  let fallbackHashtags = '';

  if (!collectiveIntelligenceSection) {
    const categoryHint = store.category ? `æ¥­ç¨®ã¯ã€Œ${store.category}ã€ã€‚` : '';
    if (templateHashtags.length > 0) {
      fallbackHashtags = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\nä»¥ä¸‹ã®å›ºå®šã‚¿ã‚°ã‚’å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹:\n${templateHashtags.join(' ')}\nãã®å¾Œã«${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã«åˆã†ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¦åˆè¨ˆ5-8å€‹ã«ã™ã‚‹ã€‚#instagood #japan ãªã©ã®æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚`;
    } else {
      fallbackHashtags = `\nã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ã€‘\n${categoryHint}ã“ã®æŠ•ç¨¿å†…å®¹ã‚’ç›´æ¥èª­ã‚“ã§ã€å†…å®¹ã«æœ€ã‚‚åˆã†Instagramãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’5-8å€‹ä»˜ã‘ã‚‹ã€‚æ¥­ç¨®ã‚¿ã‚°ã¨æŠ•ç¨¿å†…å®¹ã‚¿ã‚°ã‚’ä¸¡æ–¹å«ã‚ã‚‹ã“ã¨ã€‚#instagood #japan #photooftheday ãªã©ã®æ±ç”¨ã‚¿ã‚°ã¯ä½¿ã‚ãªã„ã€‚`;
    }
  } else if (templateHashtags.length > 0) {
    // é›†åˆçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã§ã‚‚å›ºå®šã‚¿ã‚°ã‚’å„ªå…ˆ
    fallbackHashtags = `\nã€å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæœ€å„ªå…ˆãƒ»å¿…ãšå…ˆé ­ã«å«ã‚ã‚‹ï¼‰ã€‘\n${templateHashtags.join(' ')}\nä¸Šè¨˜ã‚’å…ˆé ­ã«ç½®ãã€é›†åˆçŸ¥ã‚¿ã‚°ã‚’å¾Œã‚ã«è¿½åŠ ã™ã‚‹ã“ã¨ã€‚`;
  }

  const characterSection = buildCharacterSection(store);

  return `ã‚ãªãŸã¯${store.name}ã®ä¸­ã®äººã§ã™ã€‚ä»Šã€Instagramã«æŠ•ç¨¿ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚

ã€ã‚ãªãŸã®æ›¸ãæ–¹ã€‘
${toneData.persona}

ã€ãƒ«ãƒ¼ãƒ«ï¼ˆå³å®ˆï¼‰ã€‘
${toneData.style_rules.map((r, i) => `${i + 1}. ${r}`).join('\n')}

ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰ï¼ˆAIä¸¸å‡ºã—ã«ãªã‚‹ã®ã§NGï¼‰ã€‘
${toneData.forbidden_words.join(', ')}

ã€å£èª¿ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¾‹ï¼ˆå‚è€ƒãƒ»å†…å®¹ã¯æŠ•ç¨¿å†…å®¹ã«ç½®ãæ›ãˆã‚‹ã“ã¨ï¼‰ã€‘
${toneData.good_examples.join('\n\n')}

ã€çµ¶å¯¾NGãªæ›¸ãæ–¹ã®ä¾‹ã€‘
${toneData.bad_examples.join('\n\n')}
${templateInfo}${characterSection}${collectiveIntelligenceSection}${fallbackHashtags}${personalization}

ã€ä»Šå›ä¼ãˆãŸã„å†…å®¹ã€‘
${userText}

ã€ä»Šå›ã®æŠ•ç¨¿ã€‘
ä¸Šè¨˜ã®å†…å®¹ã‚’ã€ã‚ãªãŸè‡ªèº«ã®è¨€è‘‰ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚

æ›¸ãæ–¹ã®ãƒã‚¤ãƒ³ãƒˆï¼š
- æœ€åˆã®1ã€œ2æ–‡ã§ã€Œæ„Ÿæƒ…ãƒ»æœ¬éŸ³ãƒ»ç™ºè¦‹ã€ã‚’æ›¸ãï¼ˆèª¬æ˜ã‹ã‚‰å§‹ã‚ãªã„ï¼‰
- å…·ä½“çš„ãªã“ã¨ã‚’æ›¸ãï¼ˆæŠ½è±¡çš„ãªè¤’ã‚è¨€è‘‰ã€Œç´ æ•µãƒ»å¹»æƒ³çš„ã€ã¯ä½¿ã‚ãªã„ï¼‰
- æ–‡å­—æ•°: ${lengthInfo.range}
${collectiveIntelligenceSection ? '- é›†åˆçŸ¥ãƒ‡ãƒ¼ã‚¿ã®æ–‡å­—æ•°ãƒ»çµµæ–‡å­—æ•°ãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’åæ˜ ã™ã‚‹' : ''}

æŠ•ç¨¿æ–‡ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã‚„è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}

/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæƒ…å ±ã‚’ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®ç›´å‰ã«æŒ¿å…¥ã™ã‚‹ï¼ˆAIã«æ¸¡ã•ãšç›´æ¥ä»˜ã‘ã‚‹ï¼‰
 * æ§‹é€ : æœ¬æ–‡ â†’ ä½æ‰€ãƒ»å–¶æ¥­æ™‚é–“ãªã© â†’ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° â†’ â”â”â” Photo Advice â”â”â”
 */
export function appendTemplateFooter(postContent, store) {
  const templates = store.config?.templates || {};
  const infoLines = [];

  if (templates.ä½æ‰€) infoLines.push(`ğŸ“ ${templates.ä½æ‰€}`);
  if (templates.å–¶æ¥­æ™‚é–“) infoLines.push(`ğŸ• ${templates.å–¶æ¥­æ™‚é–“}`);
  Object.entries(templates.custom_fields || {}).forEach(([k, v]) => {
    infoLines.push(`${k}: ${v}`);
  });

  if (infoLines.length === 0) return postContent;

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œï¼ˆ#ã§å§‹ã¾ã‚‹è¡Œï¼‰ã¨Photo AdviceåŒºåˆ‡ã‚Šç·šã‚’æ¢ã™
  // åŒºåˆ‡ã‚Šç·šï¼ˆâ”ï¼‰ã§PostAdviceã‚’åˆ†é›¢
  const dividerPattern = /\n(â”{5,}[\s\S]*)/;
  const dividerMatch = postContent.match(dividerPattern);

  if (dividerMatch) {
    // åŒºåˆ‡ã‚Šç·šãŒã‚ã‚‹å ´åˆï¼šåŒºåˆ‡ã‚Šç·šã®å‰ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œã‚’è¦‹ã¤ã‘ã¦ãã®å‰ã«æŒ¿å…¥
    const beforeDivider = postContent.slice(0, dividerMatch.index);
    const dividerAndAfter = dividerMatch[1];

    // beforeDividerå†…ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œï¼ˆ#ã§å§‹ã¾ã‚‹è¡Œï¼‰ã‚’åˆ†é›¢
    const hashtagLinePattern = /\n(#[^\n]+)(\s*)$/;
    const hashtagMatch = beforeDivider.match(hashtagLinePattern);

    if (hashtagMatch) {
      const bodyPart = beforeDivider.slice(0, hashtagMatch.index);
      const hashtagPart = hashtagMatch[1];
      // L5ä¿®æ­£: ä½™åˆ†ãªâ”ã‚’è¿½åŠ ã—ãªã„ï¼ˆdividerAndAfterã«ã¯æ—¢ã«â”ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼‰
      return `${bodyPart}\n\n${infoLines.join('\n')}\n${hashtagPart}\n\n${dividerAndAfter}`;
    }
    // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡ŒãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯åŒºåˆ‡ã‚Šç·šã®å‰ã«æŒ¿å…¥
    return `${beforeDivider}\n\n${infoLines.join('\n')}\n\n${dividerAndAfter}`;
  }

  // åŒºåˆ‡ã‚Šç·šãŒãªã„å ´åˆï¼šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¡Œã®å‰ã«æŒ¿å…¥
  const hashtagLinePattern = /\n(#[^\n]+)\s*$/;
  const hashtagMatch = postContent.match(hashtagLinePattern);

  if (hashtagMatch) {
    const bodyPart = postContent.slice(0, hashtagMatch.index);
    const hashtagPart = hashtagMatch[1];
    return `${bodyPart}\n\n${infoLines.join('\n')}\n${hashtagPart}`;
  }

  // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚‚åŒºåˆ‡ã‚Šç·šã‚‚ãªã„å ´åˆã¯æœ«å°¾ã«è¿½è¨˜
  return `${postContent}\n\n${infoLines.join('\n')}`;
}

/**
 * hook_typeã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildHookTypeJapanese(hookType) {
  const map = {
    emotion: 'æ„Ÿæƒ…ãƒ»æœ¬éŸ³å…ˆè¡Œï¼ˆã€Œã‚„ã°ã„ã€ã€Œå¥½ãã™ãã€ãªã©ï¼‰',
    question: 'å•ã„ã‹ã‘ï¼ˆã€Œã€œçŸ¥ã£ã¦ã‚‹ï¼Ÿã€ãªã©ï¼‰',
    taigen_dome: 'ä½“è¨€æ­¢ã‚ï¼ˆçŸ­ã„åè©ã§ä½™ç™½ã‚’ä½œã‚‹ï¼‰',
    fact: 'äº‹å®Ÿãƒ»ãŠçŸ¥ã‚‰ã›å…ˆè¡Œ',
    unknown: 'æ§˜ã€…',
  };
  return map[hookType] || hookType;
}

/**
 * CTAä½ç½®ã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildCTAPositionJapanese(pos) {
  const map = {
    none: 'CTAãªã—',
    early: 'å†’é ­ï¼ˆè¡Œå‹•å–šèµ·ã‚’æœ€åˆã«ï¼‰',
    middle: 'ä¸­ç›¤',
    end: 'æœ«å°¾ï¼ˆæœ€å¾Œã«è¡Œå‹•å–šèµ·ï¼‰',
  };
  return map[pos] || pos;
}

/**
 * æ–‡å­—æ•°å¸¯ã‚’æ—¥æœ¬èªã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 */
function buildCharBucketJapanese(bucket) {
  const map = {
    short: '100æ–‡å­—æœªæº€ï¼ˆçŸ­æ–‡ï¼‰',
    medium: '100ã€œ200æ–‡å­—ï¼ˆä¸­æ–‡ï¼‰',
    long: '200æ–‡å­—ä»¥ä¸Šï¼ˆé•·æ–‡ï¼‰',
  };
  return map[bucket] || 'ä¸æ˜';
}

/**
 * ä¿¡é ¼ãƒ¬ãƒ™ãƒ«ã‚’ãƒ©ãƒ™ãƒ«è¡¨è¨˜ã«å¤‰æ›ï¼ˆpromptBuilderå†…éƒ¨ç”¨ï¼‰
 * - low    : 10ã€œ19ä»¶ï¼ˆä»®èª¬æ®µéšï¼‰
 * - medium : 20ã€œ29ä»¶ï¼ˆå‚è€ƒå€¤ï¼‰
 * - high   : 30ä»¶ä»¥ä¸Šï¼ˆé«˜ä¿¡é ¼ï¼‰
 */
function buildConfidenceLabel(level) {
  const map = {
    low: 'ã€ä»®èª¬æ®µéšã€‘',
    medium: 'ã€å‚è€ƒå€¤ã€‘',
    high: 'ã€é«˜ä¿¡é ¼ã€‘',
  };
  return map[level] ? `${map[level]}` : '';
}

/**
 * ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ãä¿®æ­£ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildRevisionPrompt(store, learningData, originalPost, feedback, advancedPersonalization = '') {
  const toneData = getToneData(store.tone);
  const characterSection = buildCharacterSection(store);

  return `ã‚ãªãŸã¯${store.name}ã®Instagramæ‹…å½“è€…ã§ã™ã€‚ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

ã€çµ¶å¯¾ã«ä½¿ã‚ãªã„è¨€è‘‰ï¼ˆAIä¸¸å‡ºã—ã«ãªã‚‹ã®ã§NGï¼‰ã€‘
${toneData.forbidden_words.join(', ')}
${advancedPersonalization}${characterSection}
ã€å…ƒã®æŠ•ç¨¿ã€‘
${originalPost}

ã€ä¿®æ­£æŒ‡ç¤ºï¼ˆã“ã‚Œã ã‘ã‚’å®ˆã‚Œã°ååˆ†ï¼‰ã€‘
${feedback}

ä¿®æ­£æŒ‡ç¤ºã‚’100%åæ˜ ã—ã¦ãã ã•ã„ã€‚ä¿®æ­£æŒ‡ç¤ºã«æ›¸ã‹ã‚Œã¦ã„ãªã„ã“ã¨ã¯å…ƒã®æŠ•ç¨¿ã‚’ãã®ã¾ã¾ç¶­æŒã—ã¦ãã ã•ã„ã€‚
ä¿®æ­£ã—ãŸæŠ•ç¨¿ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ãƒ»è£œè¶³ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚`;
}
